<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniForm Smart - Student Dashboard</title>
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --light-bg: #f8fafc;
            --white-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
            --border-radius: 16px;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            --gradient-warning: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        [data-theme="dark"] {
            --light-bg: #0f172a;
            --white-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--light-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.1"/><circle cx="80" cy="30" r="1.5" fill="white" opacity="0.1"/><circle cx="40" cy="70" r="1" fill="white" opacity="0.1"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title h1 {
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header-title .logo {
            font-size: 3rem;
        }

        .header-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 8px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle, .help-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover, .help-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Progress Stepper */
        .progress-stepper {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .stepper-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            flex: 1;
            min-width: 120px;
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            border: 3px solid var(--border-color);
            background: var(--white-bg);
            color: var(--text-secondary);
        }

        .step.active .step-circle {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            color: var(--text-secondary);
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: var(--text-primary);
        }

        .step-connector {
            position: absolute;
            top: 25px;
            right: -50%;
            width: 100%;
            height: 3px;
            background: var(--border-color);
            z-index: -1;
        }

        .step.completed .step-connector {
            background: var(--success-color);
        }

        .step:last-child .step-connector {
            display: none;
        }

        /* Main Content Area */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        .content-panel {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .panel-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-body {
            padding: 30px;
        }

        /* Step Content */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--white-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .form-helper {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .form-helper.error {
            color: var(--danger-color);
        }

        .form-helper.warning {
            color: var(--warning-color);
        }

        /* Gender Selection */
        .gender-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 8px;
        }

        .gender-option {
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--white-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .gender-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .gender-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .gender-icon {
            font-size: 2rem;
        }

        .gender-label {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Squad Selection */
        .squad-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 8px;
        }

        .squad-option {
            padding: 15px 8px;
            border: 3px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--white-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            position: relative;
            overflow: hidden;
        }

        .squad-option:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .squad-option.selected {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .squad-red {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fee2e2, #fecaca);
        }

        .squad-red.selected {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-color: #dc2626;
        }

        .squad-yellow {
            border-color: #eab308;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }

        .squad-yellow.selected {
            background: linear-gradient(135deg, #eab308, #ca8a04);
            color: white;
            border-color: #ca8a04;
        }

        .squad-green {
            border-color: #22c55e;
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
        }

        .squad-green.selected {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border-color: #16a34a;
        }

        .squad-pink {
            border-color: #ec4899;
            background: linear-gradient(135deg, #fce7f3, #fbcfe8);
        }

        .squad-pink.selected {
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
            border-color: #db2777;
        }

        .squad-blue {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }

        .squad-blue.selected {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
        }

        .squad-orange {
            border-color: #f97316;
            background: linear-gradient(135deg, #fed7aa, #fdba74);
        }

        .squad-orange.selected {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            border-color: #ea580c;
        }

        .squad-emoji {
            font-size: 1.5rem;
        }

        .squad-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Measurement Input Helper */
        .measurement-helper {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #0ea5e9;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .helper-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .helper-icon {
            font-size: 2.5rem;
            color: #0ea5e9;
        }

        .helper-text h4 {
            color: #0c4a6e;
            margin-bottom: 5px;
        }

        .helper-text p {
            color: #075985;
            font-size: 0.9rem;
        }

        /* Toggles */
        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 8px;
        }

        .toggle-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white-bg);
        }

        .toggle-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .toggle-option.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border-color);
            border-radius: 14px;
            position: relative;
            transition: all 0.3s ease;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-option.active .toggle-switch {
            background: white;
        }

        .toggle-option.active .toggle-switch::after {
            transform: translateX(22px);
            background: var(--primary-color);
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 20px;
        }

        .recommendation-panel {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .recommendation-header {
            background: var(--gradient-success);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .recommendation-header h3 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recommendation-body {
            padding: 25px;
        }

        .size-recommendation {
            text-align: center;
            margin-bottom: 25px;
        }

        .size-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .confidence-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .ai-comparison {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .ai-comparison h5 {
            color: #0c4a6e;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-suggestion {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0ea5e9;
        }

        /* Garment Grid */
        .garments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .garment-card {
            background: var(--white-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .garment-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .garment-card.selected {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
        }

        .garment-image {
            height: 200px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
        }

        .garment-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .garment-info {
            padding: 20px;
        }

        .garment-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .garment-measures {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .measure-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--light-bg);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .measure-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        .measure-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .measure-badge.auto {
            background: #dcfce7;
            color: #166534;
        }

        .measure-badge.manual {
            background: #fef3c7;
            color: #92400e;
        }

        /* Buttons */
        .btn {
            background: var(--primary-color);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            justify-content: center;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: #5b5bd6;
        }

        .btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #ecfdf5;
            color: #065f46;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: #fef2f2;
            color: #991b1b;
            border-left: 4px solid var(--danger-color);
        }

        .alert-warning {
            background: #fffbeb;
            color: #92400e;
            border-left: 4px solid var(--warning-color);
        }

        .alert-info {
            background: #eff6ff;
            color: #1e40af;
            border-left: 4px solid var(--info-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--white-bg);
            margin: 2% auto;
            padding: 0;
            border-radius: var(--border-radius);
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
        }

        /* Summary Panel */
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Feedback Stars */
        .rating-stars {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 20px 0;
        }

        .star {
            font-size: 2rem;
            color: #d1d5db;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
            transform: scale(1.1);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .sidebar {
                position: static;
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 20px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-title h1 {
                font-size: 2rem;
            }

            .stepper-container {
                flex-direction: column;
                gap: 10px;
            }

            .step-connector {
                display: none;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .gender-selection {
                grid-template-columns: 1fr;
            }

            .squad-selection {
                grid-template-columns: repeat(2, 1fr);
            }

            .garments-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
                align-items: center;
            }

            .modal-content {
                margin: 5% auto;
                width: 98%;
            }

            .modal-body {
                padding: 20px;
            }
        }

        /* Dark mode specific adjustments */
        [data-theme="dark"] .measurement-helper {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border-color: #3b82f6;
        }

        [data-theme="dark"] .ai-comparison {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .fw-bold { font-weight: 700; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <div class="logo">üëî</div>
                    <div>
                        <h1>UniForm Smart</h1>
                        <div class="header-subtitle">AI-Powered Uniform Sizing Platform</div>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="help-btn" onclick="showHelp()">
                        ‚ùì Help
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        üåô Dark Mode
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress Stepper -->
        <div class="progress-stepper">
            <div class="stepper-container">
                <div class="step active" id="step-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Student Info</div>
                    <div class="step-connector"></div>
                </div>
                <div class="step" id="step-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Measurements</div>
                    <div class="step-connector"></div>
                </div>
                <div class="step" id="step-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Garments</div>
                    <div class="step-connector"></div>
                </div>
                <div class="step" id="step-4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Review</div>
                    <div class="step-connector"></div>
                </div>
                <div class="step" id="step-5">
                    <div class="step-circle">‚úì</div>
                    <div class="step-label">Complete</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Main Panel -->
            <div class="content-panel">
                <!-- Step 1: Student Information -->
                <div class="step-content active" id="content-step-1">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <span>üë§</span>
                            Student Information
                        </h2>
                    </div>
                    <div class="panel-body">
                        <form id="studentInfoForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="studentName">Full Name *</label>
                                    <input type="text" id="studentName" name="studentName" placeholder="Enter student's full name" required>
                                    <div class="form-helper">This will appear on the uniform labels</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="rollNumber">Roll Number *</label>
                                    <input type="text" id="rollNumber" name="rollNumber" placeholder="e.g., 2024001" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="class">Class *</label>
                                    <select id="class" name="class" required>
                                        <option value="">Select Class</option>
                                        <option value="1">Class 1</option>
                                        <option value="2">Class 2</option>
                                        <option value="3">Class 3</option>
                                        <option value="4">Class 4</option>
                                        <option value="5">Class 5</option>
                                        <option value="6">Class 6</option>
                                        <option value="7">Class 7</option>
                                        <option value="8">Class 8</option>
                                        <option value="9">Class 9</option>
                                        <option value="10">Class 10</option>
                                        <option value="11">Class 11</option>
                                        <option value="12">Class 12</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="division">Division *</label>
                                    <select id="division" name="division" required>
                                        <option value="">Select Division</option>
                                        <option value="A">Division A</option>
                                        <option value="B">Division B</option>
                                        <option value="C">Division C</option>
                                        <option value="D">Division D</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="dateOfBirth">Date of Birth *</label>
                                    <input type="date" id="dateOfBirth" name="dateOfBirth" onchange="calculateAge()" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="age">Age (Auto-calculated)</label>
                                    <input type="number" id="age" name="age" readonly style="background: var(--light-bg);">
                                    <div class="form-helper" id="ageHelper"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Gender *</label>
                                <div class="gender-selection">
                                    <div class="gender-option" onclick="selectGender('M')" data-gender="M">
                                        <div class="gender-icon">üë¶</div>
                                        <div class="gender-label">Male</div>
                                    </div>
                                    <div class="gender-option" onclick="selectGender('F')" data-gender="F">
                                        <div class="gender-icon">üëß</div>
                                        <div class="gender-label">Female</div>
                                    </div>
                                </div>
                                <input type="hidden" id="gender" name="gender" required>
                            </div>

                            <div class="form-group">
                                <label>Squad/House Color *</label>
                                <div class="squad-selection">
                                    <div class="squad-option squad-red" onclick="selectSquad('red')" data-squad="red">
                                        <div class="squad-emoji">üî¥</div>
                                        <div class="squad-name">Red</div>
                                    </div>
                                    <div class="squad-option squad-yellow" onclick="selectSquad('yellow')" data-squad="yellow">
                                        <div class="squad-emoji">üü°</div>
                                        <div class="squad-name">Yellow</div>
                                    </div>
                                    <div class="squad-option squad-green" onclick="selectSquad('green')" data-squad="green">
                                        <div class="squad-emoji">üü¢</div>
                                        <div class="squad-name">Green</div>
                                    </div>
                                    <div class="squad-option squad-pink" onclick="selectSquad('pink')" data-squad="pink">
                                        <div class="squad-emoji">ü©∑</div>
                                        <div class="squad-name">Pink</div>
                                    </div>
                                    <div class="squad-option squad-blue" onclick="selectSquad('blue')" data-squad="blue">
                                        <div class="squad-emoji">üîµ</div>
                                        <div class="squad-name">Blue</div>
                                    </div>
                                    <div class="squad-option squad-orange" onclick="selectSquad('orange')" data-squad="orange">
                                        <div class="squad-emoji">üü†</div>
                                        <div class="squad-name">Orange</div>
                                    </div>
                                </div>
                                <input type="hidden" id="squadColor" name="squadColor" required>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn" onclick="nextStep()">
                                    Next: Measurements ‚Üí
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Step 2: Measurements -->
                <div class="step-content" id="content-step-2">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <span>üìè</span>
                            Physical Measurements
                        </h2>
                    </div>
                    <div class="panel-body">
                        <div class="measurement-helper">
                            <div class="helper-content">
                                <div class="helper-icon">üìè</div>
                                <div class="helper-text">
                                    <h4>Measurement Tips</h4>
                                    <p>Stand straight, wear light clothing, and use a measuring tape. Our AI will help adjust for comfort and growth!</p>
                                </div>
                            </div>
                        </div>

                        <form id="measurementsForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="height">Height (cm) *</label>
                                    <input type="number" id="height" name="height" placeholder="e.g., 165" step="0.1" min="80" max="250" onchange="validateMeasurements()" required>
                                    <div class="form-helper" id="heightHelper">Typical range for your age group will be shown here</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="weight">Weight (kg) *</label>
                                    <input type="number" id="weight" name="weight" placeholder="e.g., 55.5" step="0.1" min="10" max="200" onchange="validateMeasurements()" required>
                                    <div class="form-helper" id="weightHelper">Healthy weight range will be calculated</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Body Shape (Optional)</label>
                                <div class="toggle-group">
                                    <div class="toggle-option" onclick="toggleBodyShape('slim')" data-shape="slim">
                                        <div class="toggle-label">
                                            <span>üèÉ</span>
                                            <span>Slim Build</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                    <div class="toggle-option" onclick="toggleBodyShape('broad_shoulders')" data-shape="broad_shoulders">
                                        <div class="toggle-label">
                                            <span>üí™</span>
                                            <span>Broad Shoulders</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                    <div class="toggle-option" onclick="toggleBodyShape('long_arms')" data-shape="long_arms">
                                        <div class="toggle-label">
                                            <span>ü§≤</span>
                                            <span>Long Arms</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                    <div class="toggle-option" onclick="toggleBodyShape('long_legs')" data-shape="long_legs">
                                        <div class="toggle-label">
                                            <span>ü¶µ</span>
                                            <span>Long Legs</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="fitPreference">Fit Preference</label>
                                <select id="fitPreference" name="fitPreference">
                                    <option value="standard">Standard Fit (Recommended)</option>
                                    <option value="snug">Snug Fit</option>
                                    <option value="loose">Loose/Roomy Fit</option>
                                </select>
                                <div class="form-helper">Standard fit includes appropriate ease for comfort and movement</div>
                            </div>

                            <div class="form-group">
                                <label>Additional Options</label>
                                <div class="toggle-group">
                                    <div class="toggle-option" onclick="toggleOption('sports')" data-option="sports">
                                        <div class="toggle-label">
                                            <span>‚öΩ</span>
                                            <span>Include Sports Uniforms</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                    <div class="toggle-option" onclick="toggleOption('accessories')" data-option="accessories">
                                        <div class="toggle-label">
                                            <span>üéí</span>
                                            <span>Include Accessories</span>
                                        </div>
                                        <div class="toggle-switch"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                    ‚Üê Previous
                                </button>
                                <button type="button" class="btn" onclick="generateRecommendations()">
                                    Generate Recommendations ‚Üí
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Step 3: Garments -->
                <div class="step-content" id="content-step-3">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <span>üëî</span>
                            Garment Selection & Measurements
                        </h2>
                    </div>
                    <div class="panel-body">
                        <div id="garmentFilters" class="form-group">
                            <label>Filter Garments</label>
                            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <select id="categoryFilter" onchange="filterGarments()">
                                    <option value="">All Categories</option>
                                    <option value="formal">Formal</option>
                                    <option value="sports">Sports</option>
                                    <option value="accessories">Accessories</option>
                                </select>
                                <button type="button" class="btn btn-outline" onclick="toggleAllGarments()">
                                    Select All
                                </button>
                            </div>
                        </div>

                        <div class="garments-grid" id="garmentsGrid">
                            <!-- Garments will be loaded here -->
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                ‚Üê Previous
                            </button>
                            <button type="button" class="btn" onclick="nextStep()">
                                Review Order ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Review -->
                <div class="step-content" id="content-step-4">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <span>‚úÖ</span>
                            Order Review & Confirmation
                        </h2>
                    </div>
                    <div class="panel-body">
                        <div id="orderSummary">
                            <!-- Order summary will be loaded here -->
                        </div>

                        <div class="alert alert-info">
                            <span>‚ÑπÔ∏è</span>
                            <span>Please review all measurements carefully. You can go back to make changes if needed.</span>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="prevStep()">
                                ‚Üê Previous
                            </button>
                            <button type="button" class="btn" onclick="exportSummary('pdf')">
                                üìÑ Export PDF
                            </button>
                            <button type="button" class="btn btn-success" onclick="submitOrder()">
                                üéØ Confirm Order
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Complete -->
                <div class="step-content" id="content-step-5">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <span>üéâ</span>
                            Order Submitted Successfully!
                        </h2>
                    </div>
                    <div class="panel-body">
                        <div class="text-center">
                            <div style="font-size: 4rem; margin-bottom: 20px;">‚úÖ</div>
                            <h3>Thank you!</h3>
                            <p>Your uniform order has been submitted successfully. Our tailors will begin working on it immediately.</p>
                            
                            <div style="background: var(--light-bg); padding: 20px; border-radius: 12px; margin: 30px 0;">
                                <h4>What's Next?</h4>
                                <ul style="text-align: left; margin: 15px 0;">
                                    <li>üìß You'll receive an email confirmation shortly</li>
                                    <li>üë®‚Äçüîß Our tailors will review your measurements</li>
                                    <li>üì± You'll get updates via SMS/WhatsApp</li>
                                    <li>üì¶ Delivery in 7-10 business days</li>
                                </ul>
                            </div>

                            <div class="btn-group">
                                <button type="button" class="btn btn-outline" onclick="startNewOrder()">
                                    ‚ûï New Order
                                </button>
                                <button type="button" class="btn" onclick="trackOrder()">
                                    üìç Track Order
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Size Recommendation Panel -->
                <div class="recommendation-panel">
                    <div class="recommendation-header">
                        <h3>üéØ Size Recommendation</h3>
                        <div>Powered by AI</div>
                    </div>
                    <div class="recommendation-body">
                        <div class="size-recommendation">
                            <div class="size-display" id="recommendedSize">-</div>
                            <div>Recommended Size</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                            </div>
                            <div id="confidenceText">Complete measurements to get recommendation</div>
                        </div>

                        <div class="ai-comparison" id="aiComparison" style="display: none;">
                            <h5>ü§ñ AI Suggests: <span class="ai-suggestion" id="aiSuggestion">-</span></h5>
                            <div id="aiReasoning"></div>
                            <button type="button" class="btn btn-outline" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9rem;" onclick="showSizeComparison()">
                                Why different?
                            </button>
                        </div>

                        <div style="margin-top: 20px;">
                            <h5>üí° Size Hints</h5>
                            <div id="sizeHints" style="font-size: 0.9rem; color: var(--text-secondary);">
                                Enter your measurements to see personalized tips
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="recommendation-panel">
                    <div class="recommendation-header">
                        <h3>üìä Your Profile</h3>
                    </div>
                    <div class="recommendation-body">
                        <div class="summary-item">
                            <div class="summary-label">BMI</div>
                            <div class="summary-value" id="bmiValue">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Growth Stage</div>
                            <div class="summary-value" id="growthStage">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Size Stability</div>
                            <div class="summary-value" id="sizeStability">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Selected Items</div>
                            <div class="summary-value" id="selectedCount">0</div>
                        </div>
                    </div>
                </div>

                <!-- Help Panel -->
                <div class="recommendation-panel">
                    <div class="recommendation-header">
                        <h3>üÜò Need Help?</h3>
                    </div>
                    <div class="recommendation-body">
                        <div style="font-size: 0.9rem; line-height: 1.6;">
                            <p><strong>üìû Call:</strong> +91-XXXX-XXXX</p>
                            <p><strong>üí¨ WhatsApp:</strong> +91-XXXX-XXXX</p>
                            <p><strong>üìß Email:</strong> support@uniform.school</p>
                            <br>
                            <p><strong>‚è∞ Support Hours:</strong><br>
                            Mon-Fri: 9 AM - 6 PM<br>
                            Sat: 9 AM - 2 PM</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000; max-width: 400px;"></div>
    </div>

    <!-- Modals -->

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìù How did it fit?</h2>
                <button class="modal-close" onclick="closeModal('feedbackModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <h4>Rate the overall fit:</h4>
                    <div class="rating-stars">
                        <span class="star" data-rating="1">‚≠ê</span>
                        <span class="star" data-rating="2">‚≠ê</span>
                        <span class="star" data-rating="3">‚≠ê</span>
                        <span class="star" data-rating="4">‚≠ê</span>
                        <span class="star" data-rating="5">‚≠ê</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>How was the fit?</label>
                    <select id="fitRating">
                        <option value="">Select fit rating</option>
                        <option value="too_small">Too Small</option>
                        <option value="slightly_small">Slightly Small</option>
                        <option value="perfect">Perfect Fit</option>
                        <option value="slightly_large">Slightly Large</option>
                        <option value="too_large">Too Large</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Any specific issues?</label>
                    <textarea id="feedbackNotes" placeholder="Tell us what could be improved..." rows="4"></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-outline" onclick="closeModal('feedbackModal')">
                        Skip
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitFeedback()">
                        Submit Feedback
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Size Comparison Modal -->
    <div id="sizeComparisonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ü§ñ Why AI suggests different size?</h2>
                <button class="modal-close" onclick="closeModal('sizeComparisonModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="comparisonContent">
                    <!-- Comparison content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Measurement Guide Modal -->
    <div id="measurementGuideModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìè Measurement Guide</h2>
                <button class="modal-close" onclick="closeModal('measurementGuideModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center;">
                    <h4>How to measure accurately:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 3rem;">üìè</div>
                            <h5>Height</h5>
                            <p>Stand straight against a wall, look forward, mark the top of your head</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem;">‚öñÔ∏è</div>
                            <h5>Weight</h5>
                            <p>Use a digital scale, wear light clothes, measure at the same time each day</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let currentStep = 1;
        let studentData = {};
        let selectedGender = '';
        let selectedSquad = '';
        let selectedBodyShapes = new Set();
        let selectedOptions = new Set();
        let selectedGarments = new Set();
        let recommendedSize = null;
        let aiRecommendation = null;
        let currentTheme = 'light';

        // Garment Database (simulating what would come from db.sql)
        const garmentDatabase = {
            formal: {
                male: [
                    { id: 'boys_formal_shirt_half', name: 'Formal Shirt (Half Sleeve)', emoji: 'üëî', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length'] },
                    { id: 'boys_formal_shirt_full', name: 'Formal Shirt (Full Sleeve)', emoji: 'üëî', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length'] },
                    { id: 'boys_formal_pants', name: 'Formal Pants', emoji: 'üëñ', category: 'formal', measures: ['waist', 'hip', 'inseam', 'outseam'] },
                    { id: 'boys_elastic_pants', name: 'Elastic Waist Pants', emoji: 'üëñ', category: 'formal', measures: ['waist', 'hip', 'inseam'] },
                    { id: 'boys_shorts', name: 'Formal Shorts', emoji: 'ü©≥', category: 'formal', measures: ['waist', 'hip', 'outseam'] },
                    { id: 'boys_waistcoat', name: 'Waistcoat', emoji: 'ü¶∫', category: 'formal', measures: ['chest', 'length'] },
                    { id: 'boys_blazer', name: 'Blazer', emoji: 'üß•', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length', 'length'] }
                ],
                female: [
                    { id: 'girls_formal_shirt_half', name: 'Formal Shirt (Half Sleeve)', emoji: 'üëö', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length'] },
                    { id: 'girls_formal_shirt_full', name: 'Formal Shirt (Full Sleeve)', emoji: 'üëö', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length'] },
                    { id: 'girls_pinafore', name: 'Pinafore', emoji: 'üëó', category: 'formal', measures: ['chest', 'waist', 'length'] },
                    { id: 'girls_skirt', name: 'Skirt', emoji: 'üëó', category: 'formal', measures: ['waist', 'hip', 'length'] },
                    { id: 'girls_skorts', name: 'Skorts', emoji: 'üëó', category: 'formal', measures: ['waist', 'hip', 'length'] },
                    { id: 'girls_formal_pants', name: 'Formal Pants', emoji: 'üëñ', category: 'formal', measures: ['waist', 'hip', 'inseam'] },
                    { id: 'girls_blazer', name: 'Blazer', emoji: 'üß•', category: 'formal', measures: ['chest', 'shoulder', 'sleeve_length'] }
                ]
            },
            sports: {
                male: [
                    { id: 'boys_sports_tshirt', name: 'Sports T-Shirt', emoji: 'üëï', category: 'sports', measures: ['chest', 'shoulder', 'length'] },
                    { id: 'boys_track_pants', name: 'Track Pants', emoji: 'üëñ', category: 'sports', measures: ['waist', 'hip', 'inseam'] },
                    { id: 'boys_track_shorts', name: 'Track Shorts', emoji: 'ü©≥', category: 'sports', measures: ['waist', 'hip', 'outseam'] },
                    { id: 'boys_jerkin', name: 'Sports Jerkin', emoji: 'üß•', category: 'sports', measures: ['chest', 'length'] },
                    { id: 'boys_pullover_cap', name: 'Pullover with Cap', emoji: 'üß¢', category: 'sports', measures: ['chest', 'sleeve_length'] }
                ],
                female: [
                    { id: 'girls_sports_tshirt', name: 'Sports T-Shirt', emoji: 'üëï', category: 'sports', measures: ['chest', 'shoulder', 'length'] },
                    { id: 'girls_track_pants', name: 'Track Pants', emoji: 'üëñ', category: 'sports', measures: ['waist', 'hip', 'inseam'] },
                    { id: 'girls_track_shorts', name: 'Track Shorts', emoji: 'ü©≥', category: 'sports', measures: ['waist', 'hip', 'outseam'] },
                    { id: 'girls_jerkin', name: 'Sports Jerkin', emoji: 'üß•', category: 'sports', measures: ['chest', 'length'] }
                ]
            },
            accessories: {
                unisex: [
                    { id: 'tie', name: 'School Tie', emoji: 'üëî', category: 'accessories', measures: [] },
                    { id: 'belt', name: 'Leather Belt', emoji: 'üëñ', category: 'accessories', measures: ['waist'] },
                    { id: 'socks', name: 'School Socks', emoji: 'üß¶', category: 'accessories', measures: [] },
                    { id: 'shoes', name: 'School Shoes', emoji: 'üëû', category: 'accessories', measures: [] },
                    { id: 'cap', name: 'School Cap', emoji: 'üß¢', category: 'accessories', measures: [] },
                    { id: 'bag', name: 'School Bag', emoji: 'üéí', category: 'accessories', measures: [] }
                ]
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Set max date for DOB to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateOfBirth').max = today;
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                toggleTheme();
            }
            
            // Setup form validations
            setupFormValidations();
            
            // Setup event listeners
            setupEventListeners();
            
            // Show welcome message
            showAlert('Welcome to UniForm Smart! Let\'s create your perfect uniform profile.', 'info');
        }

        function setupFormValidations() {
            const heightInput = document.getElementById('height');
            const weightInput = document.getElementById('weight');
            
            heightInput.addEventListener('input', validateMeasurements);
            weightInput.addEventListener('input', validateMeasurements);
        }

        function setupEventListeners() {
            // Star rating for feedback
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    setStarRating(rating);
                });
            });
        }

        // Theme Management
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '‚òÄÔ∏è Light Mode';
                currentTheme = 'dark';
            } else {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = 'üåô Dark Mode';
                currentTheme = 'light';
            }
            
            localStorage.setItem('theme', currentTheme);
        }

        // Step Management
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < 5) {
                    hideStep(currentStep);
                    currentStep++;
                    showStep(currentStep);
                    updateStepper();
                    
                    // Special handling for step 3 (garments)
                    if (currentStep === 3) {
                        loadGarments();
                    }
                    
                    // Special handling for step 4 (review)
                    if (currentStep === 4) {
                        generateOrderSummary();
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                hideStep(currentStep);
                currentStep--;
                showStep(currentStep);
                updateStepper();
            }
        }

        function showStep(step) {
            document.getElementById(`content-step-${step}`).classList.add('active');
            document.getElementById(`step-${step}`).classList.add('active');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideStep(step) {
            document.getElementById(`content-step-${step}`).classList.remove('active');
        }

        function updateStepper() {
            // Update step states
            for (let i = 1; i <= 5; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                stepElement.classList.remove('active', 'completed');
                
                if (i < currentStep) {
                    stepElement.classList.add('completed');
                } else if (i === currentStep) {
                    stepElement.classList.add('active');
                }
            }
        }

        function validateCurrentStep() {
            switch (currentStep) {
                case 1:
                    return validateStudentInfo();
                case 2:
                    return validateMeasurements();
                case 3:
                    return validateGarmentSelection();
                default:
                    return true;
            }
        }

        // Step 1: Student Information
        function selectGender(gender) {
            selectedGender = gender;
            document.getElementById('gender').value = gender;
            
            document.querySelectorAll('.gender-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelector(`[data-gender="${gender}"]`).classList.add('selected');
            
            // Update garment availability hint
            updateGenderBasedHints();
        }

        function selectSquad(squad) {
            selectedSquad = squad;
            document.getElementById('squadColor').value = squad;
            
            document.querySelectorAll('.squad-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelector(`[data-squad="${squad}"]`).classList.add('selected');
        }

        function calculateAge() {
            const dob = document.getElementById('dateOfBirth').value;
            if (dob) {
                const today = new Date();
                const birthDate = new Date(dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                document.getElementById('age').value = age;
                
                // Update age-based hints
                updateAgeBasedHints(age);
                
                // Store in student data
                studentData.age = age;
                studentData.dateOfBirth = dob;
            }
        }

        function updateAgeBasedHints(age) {
            const helper = document.getElementById('ageHelper');
            let message = '';
            let className = '';
            
            if (age < 5) {
                message = 'Age seems too young for school uniforms. Please verify.';
                className = 'error';
            } else if (age > 18) {
                message = 'Age seems high for school uniforms. Please verify.';
                className = 'warning';
            } else if (age >= 5 && age <= 12) {
                message = 'Growing age - we\'ll add extra room for growth.';
                className = '';
            } else {
                message = 'Standard measurements will be used.';
                className = '';
            }
            
            helper.textContent = message;
            helper.className = `form-helper ${className}`;
        }

        function updateGenderBasedHints() {
            // This would update available garments preview
            if (selectedGender) {
                const genderText = selectedGender === 'M' ? 'boys' : 'girls';
                showAlert(`Gender selected: ${genderText}' uniforms will be available.`, 'info');
            }
        }

        function validateStudentInfo() {
            const requiredFields = ['studentName', 'rollNumber', 'class', 'division', 'dateOfBirth'];
            let isValid = true;
            
            // Check required fields
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    showAlert(`Please fill in ${field.previousElementSibling.textContent}`, 'error');
                    field.focus();
                    isValid = false;
                    return false;
                }
            });
            
            // Check gender selection
            if (!selectedGender) {
                showAlert('Please select gender', 'error');
                isValid = false;
            }
            
            // Check squad selection
            if (!selectedSquad) {
                showAlert('Please select a squad/house color', 'error');
                isValid = false;
            }
            
            if (isValid) {
                // Store student data
                studentData = {
                    ...studentData,
                    studentName: document.getElementById('studentName').value,
                    rollNumber: document.getElementById('rollNumber').value,
                    class: document.getElementById('class').value,
                    division: document.getElementById('division').value,
                    gender: selectedGender,
                    squadColor: selectedSquad
                };
                
                showAlert('‚úÖ Student information saved!', 'success');
            }
            
            return isValid;
        }

        // Step 2: Measurements
        function validateMeasurements() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const age = studentData.age || parseInt(document.getElementById('age').value);
            
            let isValid = true;
            
            // Validate height
            if (!height || height < 80 || height > 250) {
                document.getElementById('heightHelper').textContent = 'Please enter a valid height between 80-250 cm';
                document.getElementById('heightHelper').className = 'form-helper error';
                isValid = false;
            } else {
                // Age-appropriate height validation
                const heightRanges = getHeightRangeForAge(age);
                if (height < heightRanges.min || height > heightRanges.max) {
                    document.getElementById('heightHelper').textContent = `Height seems ${height < heightRanges.min ? 'low' : 'high'} for age ${age}. Typical range: ${heightRanges.min}-${heightRanges.max}cm`;
                    document.getElementById('heightHelper').className = 'form-helper warning';
                } else {
                    document.getElementById('heightHelper').textContent = '‚úÖ Height is within normal range for your age';
                    document.getElementById('heightHelper').className = 'form-helper';
                }
            }
            
            // Validate weight
            if (!weight || weight < 10 || weight > 200) {
                document.getElementById('weightHelper').textContent = 'Please enter a valid weight between 10-200 kg';
                document.getElementById('weightHelper').className = 'form-helper error';
                isValid = false;
            } else {
                // Calculate and display BMI
                const bmi = calculateBMI(height, weight);
                const bmiCategory = getBMICategory(bmi, age);
                document.getElementById('weightHelper').textContent = `BMI: ${bmi.toFixed(1)} (${bmiCategory})`;
                document.getElementById('weightHelper').className = 'form-helper';
                
                // Update sidebar
                document.getElementById('bmiValue').textContent = bmi.toFixed(1);
            }
            
            if (isValid && height && weight) {
                // Store measurements
                studentData.height = height;
                studentData.weight = weight;
                studentData.fitPreference = document.getElementById('fitPreference').value;
                studentData.bodyShapes = Array.from(selectedBodyShapes);
                studentData.includesSports = selectedOptions.has('sports');
                studentData.includesAccessories = selectedOptions.has('accessories');
                
                // Update profile stats
                updateProfileStats();
                
                showAlert('‚úÖ Measurements validated successfully!', 'success');
            }
            
            return isValid;
        }

        function getHeightRangeForAge(age) {
            // Simplified height ranges by age (in cm)
            const ranges = {
                5: { min: 100, max: 120 },
                6: { min: 105, max: 125 },
                7: { min: 110, max: 130 },
                8: { min: 115, max: 135 },
                9: { min: 120, max: 140 },
                10: { min: 125, max: 145 },
                11: { min: 130, max: 150 },
                12: { min: 135, max: 160 },
                13: { min: 140, max: 170 },
                14: { min: 145, max: 175 },
                15: { min: 150, max: 180 },
                16: { min: 155, max: 185 },
                17: { min: 160, max: 185 },
                18: { min: 160, max: 190 }
            };
            
            return ranges[age] || { min: 150, max: 180 };
        }

        function calculateBMI(height, weight) {
            return weight / Math.pow(height / 100, 2);
        }

        function getBMICategory(bmi, age) {
            // Simplified BMI categories for children/teens
            if (age < 18) {
                if (bmi < 16) return 'Underweight';
                if (bmi < 23) return 'Normal';
                if (bmi < 27) return 'Overweight';
                return 'Obese';
            } else {
                if (bmi < 18.5) return 'Underweight';
                if (bmi < 25) return 'Normal';
                if (bmi < 30) return 'Overweight';
                return 'Obese';
            }
        }

        function toggleBodyShape(shape) {
            const element = document.querySelector(`[data-shape="${shape}"]`);
            
            if (selectedBodyShapes.has(shape)) {
                selectedBodyShapes.delete(shape);
                element.classList.remove('active');
            } else {
                selectedBodyShapes.add(shape);
                element.classList.add('active');
            }
        }

        function toggleOption(option) {
            const element = document.querySelector(`[data-option="${option}"]`);
            
            if (selectedOptions.has(option)) {
                selectedOptions.delete(option);
                element.classList.remove('active');
            } else {
                selectedOptions.add(option);
                element.classList.add('active');
            }
        }

        function updateProfileStats() {
            const height = studentData.height;
            const weight = studentData.weight;
            const age = studentData.age;
            
            if (height && weight && age) {
                // Growth stage
                let growthStage = 'Stable';
                if (age <= 12) growthStage = 'Growing';
                else if (age <= 16) growthStage = 'Rapid Growth';
                
                document.getElementById('growthStage').textContent = growthStage;
                
                // Size stability
                const bmi = calculateBMI(height, weight);
                let stability = 'Good';
                if (bmi < 16 || bmi > 27) stability = 'Monitor';
                
                document.getElementById('sizeStability').textContent = stability;
            }
        }

        // Step 2.5: Generate Recommendations
        function generateRecommendations() {
            if (!validateMeasurements()) return;
            
            showAlert('ü§ñ Generating AI recommendations...', 'info');
            
            // Simulate API calls to both SQL and AI services
            setTimeout(() => {
                // Simulate SQL recommendation (fn_best_size_id)
                recommendedSize = calculateSQLSize();
                
                // Simulate AI recommendation
                aiRecommendation = calculateAISize();
                
                // Update recommendation panel
                updateRecommendationPanel();
                
                // Show success and proceed
                showAlert('‚úÖ Recommendations generated! Review and proceed to garment selection.', 'success');
                nextStep();
                
            }, 2000);
        }

        function calculateSQLSize() {
            // Simulate SQL size calculation logic
            const { height, weight, age, gender } = studentData;
            const bmi = calculateBMI(height, weight);
            
            let sizeCode = 'medium';
            let confidence = 0.85;
            
            // Simplified size logic based on height and age
            if (gender === 'M') {
                if (height < 130) sizeCode = 'small';
                else if (height < 150) sizeCode = 'medium';
                else if (height < 170) sizeCode = 'large';
                else sizeCode = 'large+';
            } else {
                if (height < 125) sizeCode = 'small';
                else if (height < 145) sizeCode = 'medium';
                else if (height < 165) sizeCode = 'large';
                else sizeCode = 'large+';
            }
            
            // Adjust for weight/BMI
            if (bmi > 25) {
                const sizes = ['small-', 'small', 'small+', 'medium', 'medium+', 'large', 'large+'];
                const currentIndex = sizes.indexOf(sizeCode);
                if (currentIndex < sizes.length - 1) {
                    sizeCode = sizes[currentIndex + 1];
                }
            }
            
            return {
                sizeCode,
                confidence,
                method: 'SQL Rule-based',
                reasoning: `Based on height ${height}cm, weight ${weight}kg, and age ${age} years`
            };
        }

        function calculateAISize() {
            // Simulate AI prediction with different logic
            const { height, weight, age, gender, bodyShapes, fitPreference } = studentData;
            
            let sizeCode = recommendedSize.sizeCode;
            let confidence = 0.92;
            
            // AI might suggest different size based on additional factors
            if (bodyShapes.includes('slim') && Math.random() > 0.5) {
                const sizes = ['small-', 'small', 'small+', 'medium', 'medium+', 'large', 'large+'];
                const currentIndex = sizes.indexOf(sizeCode);
                if (currentIndex > 0) {
                    sizeCode = sizes[currentIndex - 1];
                    confidence = 0.88;
                }
            }
            
            if (fitPreference === 'loose') {
                const sizes = ['small-', 'small', 'small+', 'medium', 'medium+', 'large', 'large+'];
                const currentIndex = sizes.indexOf(sizeCode);
                if (currentIndex < sizes.length - 1) {
                    sizeCode = sizes[currentIndex + 1];
                }
            }
            
            return {
                sizeCode,
                confidence,
                method: 'AI Machine Learning',
                reasoning: `Advanced pattern recognition considering body shape and fit preferences`
            };
        }

        function updateRecommendationPanel() {
            // Update main recommendation
            document.getElementById('recommendedSize').textContent = recommendedSize.sizeCode.toUpperCase();
            document.getElementById('confidenceFill').style.width = `${recommendedSize.confidence * 100}%`;
            document.getElementById('confidenceText').textContent = `${(recommendedSize.confidence * 100).toFixed(0)}% confidence`;
            
            // Show AI comparison if different
            const aiComparison = document.getElementById('aiComparison');
            if (aiRecommendation.sizeCode !== recommendedSize.sizeCode) {
                document.getElementById('aiSuggestion').textContent = aiRecommendation.sizeCode.toUpperCase();
                document.getElementById('aiReasoning').textContent = `${(aiRecommendation.confidence * 100).toFixed(0)}% confidence - ${aiRecommendation.reasoning}`;
                aiComparison.style.display = 'block';
            } else {
                aiComparison.style.display = 'none';
            }
            
            // Update size hints
            updateSizeHints();
        }

        function updateSizeHints() {
            const hints = [];
            const { age, height, weight } = studentData;
            const sizes = ['small-', 'small', 'small+', 'medium', 'medium+', 'large', 'large+'];
            const currentIndex = sizes.indexOf(recommendedSize.sizeCode);
            
            // Growth buffer for kids
            if (age <= 12) {
                hints.push('üí° Added growth allowance for growing children');
            }
            
            // Size boundary warnings
            if (currentIndex === 0) {
                hints.push('‚ö†Ô∏è You\'re at the smallest size available');
            } else if (currentIndex === sizes.length - 1) {
                hints.push('‚ö†Ô∏è You\'re at the largest size available');
            } else if (currentIndex >= sizes.length - 2) {
                hints.push('üìè Consider custom sizing if standard doesn\'t fit well');
            }
            
            // Fit preference hints
            const fitPref = studentData.fitPreference;
            if (fitPref === 'loose') {
                hints.push('üëï Adjusted for loose fit preference');
            } else if (fitPref === 'snug') {
                hints.push('üéØ Adjusted for snug fit preference');
            }
            
            document.getElementById('sizeHints').innerHTML = hints.length > 0 ? hints.join('<br>') : 'Standard sizing applied';
        }

        // Step 3: Garments
        function loadGarments() {
            const container = document.getElementById('garmentsGrid');
            container.innerHTML = '';
            
            const gender = studentData.gender;
            const includesSports = selectedOptions.has('sports');
            const includesAccessories = selectedOptions.has('accessories');
            
            let garments = [];
            
            // Add formal garments
            if (gender === 'M') {
                garments = [...garmentDatabase.formal.male];
            } else {
                garments = [...garmentDatabase.formal.female];
            }
            
            // Add sports garments if selected
            if (includesSports) {
                if (gender === 'M') {
                    garments = [...garments, ...garmentDatabase.sports.male];
                } else {
                    garments = [...garments, ...garmentDatabase.sports.female];
                }
            }
            
            // Add accessories if selected
            if (includesAccessories) {
                garments = [...garments, ...garmentDatabase.accessories.unisex];
            }
            
            // Render garments
            garments.forEach(garment => {
                const card = createGarmentCard(garment);
                container.appendChild(card);
            });
            
            // Auto-select essential garments
            autoSelectEssentialGarments(garments);
            
            updateSelectedCount();
        }

        function createGarmentCard(garment) {
            const card = document.createElement('div');
            card.className = 'garment-card';
            card.dataset.garmentId = garment.id;
            card.dataset.category = garment.category;
            
            // Generate mock measurements
            const measurements = generateMockMeasurements(garment);
            
            card.innerHTML = `
                <div class="garment-image">
                    <div style="font-size: 4rem;">${garment.emoji}</div>
                    <div class="garment-badge">${garment.category}</div>
                </div>
                <div class="garment-info">
                    <div class="garment-name">${garment.name}</div>
                    <div class="garment-measures">
                        ${measurements.map(measure => `
                            <div class="measure-item">
                                <span>${measure.name}</span>
                                <div>
                                    <span class="measure-value">${measure.value}cm</span>
                                    <span class="measure-badge ${measure.method}">${measure.method}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn btn-outline" onclick="toggleGarment('${garment.id}')" id="btn-${garment.id}">
                            Select
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        function generateMockMeasurements(garment) {
            const { height, weight } = studentData;
            const measurements = [];
            
            // Generate realistic measurements based on height/weight
            garment.measures.forEach(measureName => {
                let value = 0;
                let method = Math.random() > 0.7 ? 'manual' : 'auto'; // 30% manual, 70% auto
                
                switch (measureName) {
                    case 'chest':
                        value = Math.round((height * 0.52) + (weight * 0.4) + Math.random() * 4 - 2);
                        break;
                    case 'waist':
                        value = Math.round((height * 0.42) + (weight * 0.3) + Math.random() * 4 - 2);
                        break;
                    case 'hip':
                        value = Math.round((height * 0.54) + (weight * 0.35) + Math.random() * 4 - 2);
                        break;
                    case 'shoulder':
                        value = Math.round((height * 0.25) + Math.random() * 3 - 1.5);
                        break;
                    case 'sleeve_length':
                        value = Math.round((height * 0.32) + Math.random() * 3 - 1.5);
                        break;
                    case 'inseam':
                        value = Math.round((height * 0.45) + Math.random() * 4 - 2);
                        break;
                    case 'outseam':
                        value = Math.round((height * 0.58) + Math.random() * 4 - 2);
                        break;
                    case 'length':
                        value = Math.round((height * 0.35) + Math.random() * 4 - 2);
                        break;
                    default:
                        value = Math.round(height * 0.3 + Math.random() * 5);
                }
                
                measurements.push({
                    name: measureName.replace('_', ' '),
                    value: Math.max(value, 20), // Minimum 20cm
                    method
                });
            });
            
            return measurements;
        }

        function autoSelectEssentialGarments(garments) {
            // Auto-select essential garments
            const essential = ['formal_shirt', 'formal_pants', 'skirt', 'pinafore'];
            
            garments.forEach(garment => {
                const isEssential = essential.some(keyword => garment.id.includes(keyword));
                if (isEssential) {
                    toggleGarment(garment.id, true);
                }
            });
        }

        function toggleGarment(garmentId, forceSelect = false) {
            const card = document.querySelector(`[data-garment-id="${garmentId}"]`);
            const button = document.getElementById(`btn-${garmentId}`);
            
            if (selectedGarments.has(garmentId) && !forceSelect) {
                selectedGarments.delete(garmentId);
                card.classList.remove('selected');
                button.textContent = 'Select';
                button.classList.remove('btn-success');
                button.classList.add('btn-outline');
            } else {
                selectedGarments.add(garmentId);
                card.classList.add('selected');
                button.textContent = '‚úì Selected';
                button.classList.remove('btn-outline');
                button.classList.add('btn-success');
            }
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedGarments.size;
        }

        function filterGarments() {
            const filter = document.getElementById('categoryFilter').value;
            const cards = document.querySelectorAll('.garment-card');
            
            cards.forEach(card => {
                if (!filter || card.dataset.category === filter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function toggleAllGarments() {
            const visibleCards = document.querySelectorAll('.garment-card:not([style*="display: none"])');
            const button = event.target;
            
            if (button.textContent.includes('Select All')) {
                visibleCards.forEach(card => {
                    const garmentId = card.dataset.garmentId;
                    if (!selectedGarments.has(garmentId)) {
                        toggleGarment(garmentId, true);
                    }
                });
                button.textContent = 'Deselect All';
            } else {
                visibleCards.forEach(card => {
                    const garmentId = card.dataset.garmentId;
                    if (selectedGarments.has(garmentId)) {
                        toggleGarment(garmentId, false);
                    }
                });
                button.textContent = 'Select All';
            }
        }

        function validateGarmentSelection() {
            if (selectedGarments.size === 0) {
                showAlert('Please select at least one garment', 'warning');
                return false;
            }
            
            showAlert(`‚úÖ ${selectedGarments.size} garments selected!`, 'success');
            return true;
        }

        // Step 4: Review & Summary
        function generateOrderSummary() {
            const container = document.getElementById('orderSummary');
            
            const summary = `
                <div class="summary-section">
                    <h4>üë§ Student Information</h4>
                    <div class="summary-item">
                        <span class="summary-label">Name:</span>
                        <span class="summary-value">${studentData.studentName}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Roll Number:</span>
                        <span class="summary-value">${studentData.rollNumber}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Class:</span>
                        <span class="summary-value">${studentData.class}-${studentData.division}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Age:</span>
                        <span class="summary-value">${studentData.age} years</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Gender:</span>
                        <span class="summary-value">${studentData.gender === 'M' ? 'Male' : 'Female'}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Squad:</span>
                        <span class="summary-value">${studentData.squadColor.toUpperCase()}</span>
                    </div>
                </div>

                <div class="summary-section" style="margin-top: 30px;">
                    <h4>üìè Measurements</h4>
                    <div class="summary-item">
                        <span class="summary-label">Height:</span>
                        <span class="summary-value">${studentData.height} cm</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Weight:</span>
                        <span class="summary-value">${studentData.weight} kg</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">BMI:</span>
                        <span class="summary-value">${calculateBMI(studentData.height, studentData.weight).toFixed(1)}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Fit Preference:</span>
                        <span class="summary-value">${studentData.fitPreference || 'Standard'}</span>
                    </div>
                </div>

                <div class="summary-section" style="margin-top: 30px;">
                    <h4>üéØ Size Recommendation</h4>
                    <div class="summary-item">
                        <span class="summary-label">Recommended Size:</span>
                        <span class="summary-value">${recommendedSize.sizeCode.toUpperCase()}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Confidence:</span>
                        <span class="summary-value">${(recommendedSize.confidence * 100).toFixed(0)}%</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Method:</span>
                        <span class="summary-value">${recommendedSize.method}</span>
                    </div>
                    ${aiRecommendation.sizeCode !== recommendedSize.sizeCode ? `
                    <div class="summary-item">
                        <span class="summary-label">AI Alternative:</span>
                        <span class="summary-value">${aiRecommendation.sizeCode.toUpperCase()} (${(aiRecommendation.confidence * 100).toFixed(0)}%)</span>
                    </div>
                    ` : ''}
                </div>

                <div class="summary-section" style="margin-top: 30px;">
                    <h4>üëî Selected Garments (${selectedGarments.size})</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        ${Array.from(selectedGarments).map(garmentId => {
                            const garment = findGarmentById(garmentId);
                            return `
                                <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 2rem;">${garment.emoji}</div>
                                    <div style="font-weight: 600; margin-top: 8px;">${garment.name}</div>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">${garment.category}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div class="summary-section" style="margin-top: 30px;">
                    <h4>üìä Order Statistics</h4>
                    <div class="summary-item">
                        <span class="summary-label">Total Garments:</span>
                        <span class="summary-value">${selectedGarments.size}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Formal Items:</span>
                        <span class="summary-value">${countGarmentsByCategory('formal')}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Sports Items:</span>
                        <span class="summary-value">${countGarmentsByCategory('sports')}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Accessories:</span>
                        <span class="summary-value">${countGarmentsByCategory('accessories')}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Est. Delivery:</span>
                        <span class="summary-value">7-10 business days</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = summary;
        }

        function findGarmentById(garmentId) {
            // Search through all garment categories
            for (const category in garmentDatabase) {
                for (const gender in garmentDatabase[category]) {
                    const garment = garmentDatabase[category][gender].find(g => g.id === garmentId);
                    if (garment) return garment;
                }
            }
            return null;
        }

        function countGarmentsByCategory(category) {
            let count = 0;
            selectedGarments.forEach(garmentId => {
                const garment = findGarmentById(garmentId);
                if (garment && garment.category === category) count++;
            });
            return count;
        }

        // Export and Submit
        function exportSummary(format) {
            showAlert(`üìÑ Exporting order summary as ${format.toUpperCase()}...`, 'info');
            
            setTimeout(() => {
                // Simulate export
                const filename = `${studentData.studentName}_${studentData.rollNumber}_uniform_order.${format}`;
                showAlert(`‚úÖ ${filename} downloaded successfully!`, 'success');
            }, 1500);
        }

        function submitOrder() {
            showAlert('üöÄ Submitting your uniform order...', 'info');
            
            // Simulate API submission
            setTimeout(() => {
                // Store order data
                const orderData = {
                    ...studentData,
                    recommendedSize,
                    aiRecommendation,
                    selectedGarments: Array.from(selectedGarments),
                    orderDate: new Date().toISOString(),
                    orderId: 'ORD-' + Date.now()
                };
                
                localStorage.setItem('lastOrder', JSON.stringify(orderData));
                
                // Move to completion step
                nextStep();
                
                // Show feedback modal after 3 seconds
                setTimeout(() => {
                    showModal('feedbackModal');
                }, 3000);
                
            }, 2000);
        }

        // Step 5: Completion
        function startNewOrder() {
            if (confirm('Are you sure you want to start a new order? Current progress will be lost.')) {
                location.reload();
            }
        }

        function trackOrder() {
            const orderData = JSON.parse(localStorage.getItem('lastOrder') || '{}');
            if (orderData.orderId) {
                showAlert(`üìç Order ID: ${orderData.orderId} - Status: In Production`, 'info');
            } else {
                showAlert('No recent orders found', 'warning');
            }
        }

        // Modal Management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // Feedback System
        function setStarRating(rating) {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function submitFeedback() {
            const rating = document.querySelectorAll('.star.active').length;
            const fitRating = document.getElementById('fitRating').value;
            const notes = document.getElementById('feedbackNotes').value;
            
            if (rating === 0) {
                showAlert('Please provide a star rating', 'warning');
                return;
            }
            
            showAlert('üìù Submitting feedback...', 'info');
            
            setTimeout(() => {
                // Simulate feedback submission
                const feedbackData = {
                    rating,
                    fitRating,
                    notes,
                    submittedAt: new Date().toISOString()
                };
                
                console.log('Feedback submitted:', feedbackData);
                
                closeModal('feedbackModal');
                showAlert('‚úÖ Thank you for your feedback! This helps us improve our recommendations.', 'success');
            }, 1000);
        }

        // Size Comparison
        function showSizeComparison() {
            const content = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h4>ü§ñ AI vs Traditional Sizing</h4>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: var(--light-bg); border-radius: 12px;">
                        <h5>üìä Traditional Method</h5>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color); margin: 15px 0;">
                            ${recommendedSize.sizeCode.toUpperCase()}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${recommendedSize.reasoning}
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Confidence:</strong> ${(recommendedSize.confidence * 100).toFixed(0)}%
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px;">
                        <h5>ü§ñ AI Method</h5>
                        <div style="font-size: 2rem; font-weight: bold; color: #0ea5e9; margin: 15px 0;">
                            ${aiRecommendation.sizeCode.toUpperCase()}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${aiRecommendation.reasoning}
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>Confidence:</strong> ${(aiRecommendation.confidence * 100).toFixed(0)}%
                        </div>
                    </div>
                </div>
                
                <div style="background: #fffbeb; border: 1px solid #f59e0b; border-radius: 8px; padding: 20px;">
                    <h5 style="color: #92400e; margin-bottom: 10px;">üîç Why the difference?</h5>
                    <ul style="color: #92400e; font-size: 0.9rem; line-height: 1.6;">
                        <li><strong>Traditional sizing</strong> uses standard height-weight tables and basic rules</li>
                        <li><strong>AI sizing</strong> considers body shape, fit preferences, and patterns from thousands of similar students</li>
                        <li>AI learns from actual fit feedback to improve recommendations over time</li>
                        <li>Both methods include appropriate ease and growth allowances</li>
                    </ul>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">
                        üí° <strong>Recommendation:</strong> Both sizes are within normal range. Choose based on your fit preference.
                    </p>
                </div>
            `;
            
            document.getElementById('comparisonContent').innerHTML = content;
            showModal('sizeComparisonModal');
        }

        // Help System
        function showHelp() {
            showModal('measurementGuideModal');
        }

        // Alert System
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const alert = document.createElement('div');
            alert.id = alertId;
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span>${icons[type] || '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
                <button onclick="removeAlert('${alertId}')" style="background: none; border: none; color: inherit; font-size: 1.2rem; cursor: pointer; margin-left: auto;">&times;</button>
            `;
            
            alertContainer.appendChild(alert);
            
            // Auto remove after 5 seconds
            setTimeout(() => removeAlert(alertId), 5000);
        }

        function removeAlert(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => alert.remove(), 300);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    closeModal(openModal.id);
                }
            }
            
            // Navigation shortcuts
            if (e.ctrlKey) {
                switch (e.key) {
                    case 'ArrowRight':
                        e.preventDefault();
                        nextStep();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        prevStep();
                        break;
                }
            }
        });

        // Auto-save progress
        setInterval(() => {
            if (Object.keys(studentData).length > 0) {
                localStorage.setItem('uniformProgress', JSON.stringify({
                    currentStep,
                    studentData,
                    selectedGender,
                    selectedSquad,
                    selectedBodyShapes: Array.from(selectedBodyShapes),
                    selectedOptions: Array.from(selectedOptions),
                    selectedGarments: Array.from(selectedGarments),
                    lastSaved: new Date().toISOString()
                }));
            }
        }, 30000); // Save every 30 seconds

        // Load saved progress on page load
        window.addEventListener('load', function() {
            const savedProgress = localStorage.getItem('uniformProgress');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                const lastSaved = new Date(progress.lastSaved);
                const now = new Date();
                const hoursSince = (now - lastSaved) / (1000 * 60 * 60);
                
                if (hoursSince < 24 && confirm('Found saved progress from earlier. Would you like to continue where you left off?')) {
                    // Restore progress
                    currentStep = progress.currentStep;
                    studentData = progress.studentData;
                    selectedGender = progress.selectedGender;
                    selectedSquad = progress.selectedSquad;
                    selectedBodyShapes = new Set(progress.selectedBodyShapes);
                    selectedOptions = new Set(progress.selectedOptions);
                    selectedGarments = new Set(progress.selectedGarments);
                    
                    // Restore UI state
                    hideStep(1);
                    showStep(currentStep);
                    updateStepper();
                    
                    showAlert('‚úÖ Progress restored successfully!', 'success');
                }
            }
        });
    </script>
</body>
</html>