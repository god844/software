<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniForm Smart - Teacher Dashboard</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #17a2b8;
            --light-bg: #ecf0f1;
            --white-bg: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #bdc3c7;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --manufacturing-pending: #ff9800;
            --manufacturing-progress: #2196f3;
            --manufacturing-complete: #4caf50;
        }

        [data-theme="dark"] {
            --light-bg: #1a1a1a;
            --white-bg: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --primary-color: #3498db;
            --shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="0.5" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header-content p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .theme-toggle, .notification-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .notification-btn .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .theme-toggle:hover, .notification-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--white-bg);
            box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            z-index: 3000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .notification-panel.open {
            right: 0;
        }

        .notification-header {
            padding: 20px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary-color);
            color: white;
        }

        .notification-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .notification-item {
            padding: 15px;
            border-left: 4px solid var(--info-color);
            background: var(--light-bg);
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            background: var(--white-bg);
            box-shadow: var(--shadow);
        }

        .notification-item.manufacturing {
            border-color: var(--manufacturing-progress);
        }

        .notification-item.approval {
            border-color: var(--warning-color);
        }

        .notification-item.completion {
            border-color: var(--success-color);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--white-bg);
            padding: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: var(--light-bg);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card Styles */
        .card {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            font-size: 1.8rem;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-group label.optional {
            color: var(--text-secondary);
        }

        .form-group label.optional::after {
            content: " (Optional)";
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--white-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        /* Gender Selection */
        .gender-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 8px;
        }

        .gender-btn {
            padding: 18px;
            border: 2px solid var(--border-color);
            background: var(--white-bg);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .gender-btn:hover {
            border-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .gender-btn.selected {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        /* Size Range Filter */
        .size-range-filter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .size-chip {
            padding: 8px 16px;
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .size-chip:hover {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .size-chip.selected {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        /* Manufacturing Status */
        .manufacturing-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .manufacturing-status.pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--manufacturing-pending);
            border: 2px solid var(--manufacturing-pending);
        }

        .manufacturing-status.in-progress {
            background: rgba(33, 150, 243, 0.1);
            color: var(--manufacturing-progress);
            border: 2px solid var(--manufacturing-progress);
        }

        .manufacturing-status.completed {
            background: rgba(76, 175, 80, 0.1);
            color: var(--manufacturing-complete);
            border: 2px solid var(--manufacturing-complete);
        }

        .manufacturing-status.approved {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        /* Button Styles */
        .btn {
            background: var(--primary-color);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            justify-content: center;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-success { 
            background: var(--success-color); 
        }

        .btn-success:hover { 
            background: #229954; 
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .btn-warning { 
            background: var(--warning-color); 
        }

        .btn-warning:hover { 
            background: #d68910; 
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
        }

        .btn-danger { 
            background: var(--danger-color); 
        }

        .btn-danger:hover { 
            background: #c0392b; 
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Action Grid */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        /* File Upload */
        .file-upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--light-bg);
        }

        .file-upload-area:hover,
        .file-upload-area.dragover {
            border-color: var(--success-color);
            background: rgba(39, 174, 96, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover .upload-icon {
            color: var(--success-color);
            transform: scale(1.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--white-bg);
            margin: 2% auto;
            padding: 40px;
            border-radius: var(--border-radius);
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .close {
            color: var(--text-secondary);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: var(--danger-color);
            transform: scale(1.1);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--white-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .data-table th, .data-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background: var(--light-bg);
            font-weight: 700;
            color: var(--text-primary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Student Cards */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .student-card {
            background: var(--white-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-success);
        }

        .student-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .student-info h4 {
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .student-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Filters */
        .filters-bar {
            background: var(--white-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding-left: 50px;
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        /* Alerts */
        .alert {
            padding: 16px 24px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger-color);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning-color);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--secondary-color);
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Garment Inventory */
        .garment-inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .garment-inventory-card {
            background: var(--white-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .garment-inventory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .garment-inventory-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-success);
        }

        .garment-type-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .garment-type-icon {
            font-size: 2.5rem;
            margin-right: 15px;
        }

        .garment-type-info h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0 0 5px 0;
        }

        .garment-type-category {
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: var(--light-bg);
            padding: 4px 12px;
            border-radius: 15px;
            display: inline-block;
        }

        .inventory-status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .inventory-status-item {
            text-align: center;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
            border-left: 4px solid var(--secondary-color);
        }

        .inventory-status-item.manufacturing {
            border-left-color: var(--manufacturing-progress);
        }

        .inventory-status-item.completed {
            border-left-color: var(--manufacturing-complete);
        }

        .inventory-status-item.delivered {
            border-left-color: var(--success-color);
        }

        .inventory-status-item.distributed {
            border-left-color: var(--info-color);
        }

        .inventory-number {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .inventory-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .delivery-timeline {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .timeline-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
        }

        .timeline-icon.completed {
            background: var(--success-color);
        }

        .timeline-icon.pending {
            background: var(--warning-color);
        }

        .timeline-icon.in-progress {
            background: var(--info-color);
        }

        /* Delivery Summary Card */
        .delivery-summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .delivery-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="0.5" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }

        .delivery-summary-content {
            position: relative;
            z-index: 1;
        }

        .delivery-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .delivery-stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .delivery-stat-number {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .delivery-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--light-bg);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* AWS Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--white-bg);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            z-index: 2000;
        }

        .connection-status.connected {
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }

        .connection-status.disconnected {
            border-left: 4px solid var(--danger-color);
            color: var(--danger-color);
        }

        .connection-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .connection-indicator.connected {
            background: var(--success-color);
        }

        .connection-indicator.disconnected {
            background: var(--danger-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                padding: 20px;
                text-align: center;
            }

            .header-content h1 {
                font-size: 2rem;
            }

            .header-controls {
                flex-direction: column;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .students-grid {
                grid-template-columns: 1fr;
            }

            .garment-inventory-grid {
                grid-template-columns: 1fr;
            }

            .delivery-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .inventory-status-grid {
                grid-template-columns: 1fr;
            }

            .size-quantity-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .modal-content {
                margin: 5% auto;
                padding: 25px;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .student-actions {
                flex-direction: column;
            }

            .notification-panel {
                width: 100vw;
                right: -100vw;
            }

            .size-range-filter {
                grid-template-columns: repeat(2, 1fr);
            }

            .garment-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .header-content h1 {
                font-size: 1.5rem;
            }

            .header-content p {
                font-size: 1rem;
            }

            .card {
                padding: 20px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .delivery-stats {
                grid-template-columns: 1fr;
            }

            .inventory-status-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .size-quantity-grid {
                grid-template-columns: 1fr !important;
            }

            .connection-status {
                bottom: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .garment-type-header {
                flex-direction: column;
                text-align: center;
            }

            .garment-type-icon {
                margin: 0 0 10px 0;
            }
        
            
            }

            .garment-type-header {
                flex-direction: column;
                text-align: center;
            }

            .garment-type-icon {
                margin: 0 0 10px 0;
            }
        

        /* Garment Management */
        .garment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .garment-card {
            background: var(--white-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .garment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .garment-image {
            width: 100%;
            height: 200px;
            background: var(--light-bg);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 4rem;
            color: var(--text-secondary);
        }

        .garment-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .garment-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .p-relative { position: relative; }

        /* Dark mode specific adjustments */
        [data-theme="dark"] .stat-card::before,
        [data-theme="dark"] .student-card::before {
            background: var(--gradient-success);
        }

        [data-theme="dark"] .data-table th {
            background: var(--primary-color);
            color: white;
        }

        [data-theme="dark"] .notification-panel {
            background: var(--white-bg);
            border-left: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>üë®‚Äçüè´ UniForm Smart Dashboard</h1>
                <p>Advanced Student Profile & Uniform Management System</p>
            </div>
            <div class="header-controls">
                <button class="notification-btn" onclick="toggleNotificationPanel()">
                    üîî Notifications
                    <span class="notification-badge" id="notificationCount">5</span>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    üåô Dark Mode
                </button>
            </div>
        </div>

        <!-- Enhanced Statistics Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingApprovals">0</div>
                <div class="stat-label">Pending Approvals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="manufacturingOrders">0</div>
                <div class="stat-label">In Manufacturing</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedOrders">0</div>
                <div class="stat-label">Completed Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="deliveredGarments">0</div>
                <div class="stat-label">Delivered to School</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="awsStatus">Connected</div>
                <div class="stat-label">Database Status</div>
            </div>
        </div>

        <!-- Garment Inventory Overview -->
        <div class="card">
            <h2 class="card-title">
                <span class="card-icon">üëï</span>
                Garment Inventory & Delivery Status
            </h2>
            
            <div class="garment-inventory-grid" id="garmentInventoryGrid">
                <!-- Garment inventory will be loaded here -->
            </div>
        </div>

        <!-- Enhanced Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('student-entry')">
                üë§ Add Student
            </button>
            <button class="nav-tab" onclick="showTab('bulk-upload')">
                üìä Bulk Upload
            </button>
            <button class="nav-tab" onclick="showTab('view-students')">
                üë• View Students
            </button>
            <button class="nav-tab" onclick="showTab('delivery-tracking')">
                üöö Delivery Tracking
            </button>
            <button class="nav-tab" onclick="showTab('manufacturing-tracking')">
                üè≠ Manufacturing
            </button>
            <button class="nav-tab" onclick="showTab('approvals')">
                ‚úÖ Approvals
            </button>
            <button class="nav-tab" onclick="showTab('garment-management')">
                üëï Garments
            </button>
            <button class="nav-tab" onclick="showTab('search-edit')">
                üîç Search & Edit
            </button>
            <button class="nav-tab" onclick="showTab('reports')">
                üìà Reports
            </button>
        </div>

        <!-- Tab: Student Entry (Enhanced) -->
        <div class="tab-content active" id="student-entry">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üë§</span>
                    Student Profile Entry
                </h2>
                
                <form id="studentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rollNumber">Roll Number *</label>
                            <input type="text" id="rollNumber" name="rollNumber" placeholder="Enter roll number" required>
                        </div>
                        <div class="form-group">
                            <label for="regNumber">Register Number *</label>
                            <input type="text" id="regNumber" name="regNumber" placeholder="Enter register number" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="studentName">Student Full Name *</label>
                        <input type="text" id="studentName" name="studentName" placeholder="Enter student's full name" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="class">Class *</label>
                            <input type="text" id="class" name="class" placeholder="Enter class (e.g., 1, 2, 10, 12)" required>
                        </div>
                        <div class="form-group">
                            <label for="division">Division *</label>
                            <input type="text" id="division" name="division" placeholder="Enter division (e.g., A, B, C)" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dob">Date of Birth *</label>
                            <input type="date" id="dob" name="dob" onchange="calculateAge()" required>
                        </div>
                        <div class="form-group">
                            <label for="age">Age (Auto-calculated)</label>
                            <input type="number" id="age" name="age" readonly style="background: var(--light-bg);">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Gender *</label>
                        <div class="gender-buttons">
                            <div class="gender-btn" onclick="selectGender('M')" data-gender="M">
                                üë¶ Male
                            </div>
                            <div class="gender-btn" onclick="selectGender('F')" data-gender="F">
                                üëß Female
                            </div>
                        </div>
                        <input type="hidden" id="gender" name="gender" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="height" class="optional">Height (cm)</label>
                            <input type="number" id="height" name="height" placeholder="e.g., 165" step="0.1" min="80" max="250">
                        </div>
                        <div class="form-group">
                            <label for="weight" class="optional">Weight (kg)</label>
                            <input type="number" id="weight" name="weight" placeholder="e.g., 55.5" step="0.1" min="10" max="200">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="parentContact" class="optional">Parent Contact</label>
                            <input type="tel" id="parentContact" name="parentContact" placeholder="Enter parent's contact number">
                        </div>
                        <div class="form-group">
                            <label for="uniformSize" class="optional">Estimated Uniform Size</label>
                            <select id="uniformSize" name="uniformSize">
                                <option value="">Auto-calculate based on measurements</option>
                                <option value="XS">Extra Small (XS)</option>
                                <option value="S">Small (S)</option>
                                <option value="M">Medium (M)</option>
                                <option value="L">Large (L)</option>
                                <option value="XL">Extra Large (XL)</option>
                                <option value="XXL">Double Extra Large (XXL)</option>
                            </select>
                        </div>
                    </div>

                    <div class="actions-grid">
                        <button type="submit" class="btn btn-success">
                            üíæ Save Student
                        </button>
                        <button type="button" class="btn btn-warning" onclick="clearForm()">
                            üîÑ Clear Form
                        </button>
                        <button type="button" class="btn btn-outline" onclick="saveAndAddNew()">
                            ‚ûï Save & Add New
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab: Bulk Upload (Unchanged) -->
        <div class="tab-content" id="bulk-upload">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üìä</span>
                    Bulk Student Upload
                </h2>
                
                <div class="file-upload-area" onclick="document.getElementById('excelInput').click()">
                    <div class="upload-icon">üìÑ</div>
                    <h3>Upload Excel/CSV File</h3>
                    <p>Supported formats: .xlsx, .xls, .csv</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                        Click here or drag & drop your file
                    </p>
                    <input type="file" id="excelInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleFileUpload(event)">
                </div>

                <div id="filePreview" class="hidden mt-20">
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 10px; border: 2px solid var(--success-color);">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 2rem;">üìÑ</div>
                            <div style="flex: 1;">
                                <h4 id="fileName" style="color: var(--success-color); margin: 0 0 5px 0;">File Selected</h4>
                                <p id="fileDetails" style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">File details</p>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="removeFile()" style="padding: 8px 16px;">
                                üóëÔ∏è Remove
                            </button>
                        </div>
                    </div>
                </div>

                <div id="uploadProgress" class="hidden mt-20">
                    <div style="background: var(--white-bg); padding: 20px; border-radius: 10px; border: 2px solid var(--secondary-color);">
                        <h4 style="color: var(--secondary-color); margin: 0 0 15px 0;">Processing File...</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-center mt-20">Preparing upload...</p>
                    </div>
                </div>

                <div id="uploadResults" class="hidden mt-20">
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--success-color); margin: 0 0 15px 0;">‚úÖ Upload Completed!</h4>
                        <div id="resultsContent"></div>
                        <button class="btn btn-success mt-20" onclick="resetUpload()">
                            ‚ûï Upload Another File
                        </button>
                    </div>
                </div>

                <div class="mt-20">
                    <h3>üìã Required Excel Format:</h3>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Roll Number</th>
                                    <th>Register Number</th>
                                    <th>Student Name</th>
                                    <th>Class</th>
                                    <th>Division</th>
                                    <th>DOB (YYYY-MM-DD)</th>
                                    <th>Gender (M/F)</th>
                                    <th>Height (cm) - Optional</th>
                                    <th>Weight (kg) - Optional</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2024001</td>
                                    <td>REG001</td>
                                    <td>John Doe</td>
                                    <td>10</td>
                                    <td>A</td>
                                    <td>2008-05-15</td>
                                    <td>M</td>
                                    <td>165</td>
                                    <td>55</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="actions-grid mt-20">
                    <button class="btn" onclick="downloadTemplate()">
                        üì• Download Template
                    </button>
                    <button class="btn btn-success" onclick="processUploadedFile()" id="processBtn" disabled>
                        üöÄ Process Upload
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab: View Students (Enhanced with Size Filtering) -->
        <div class="tab-content" id="view-students">
            <div class="filters-bar">
                <div class="filters-grid">
                    <div class="form-group">
                        <label>Search Students</label>
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="searchInput" placeholder="Search by name, roll number..." onkeyup="filterStudents()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Filter by Gender</label>
                        <select id="genderFilter" onchange="filterStudents()">
                            <option value="">All Genders</option>
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filter by Class</label>
                        <select id="classFilter" onchange="filterStudents()">
                            <option value="">All Classes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Filter by Division</label>
                        <select id="divisionFilter" onchange="filterStudents()">
                            <option value="">All Divisions</option>
                        </select>
                    </div>
                </div>

                <!-- Enhanced Size Range Filtering -->
                <div class="form-group">
                    <label>Filter by Size Range</label>
                    <div class="size-range-filter">
                        <div class="size-chip" onclick="toggleSizeFilter('XS')" data-size="XS">XS</div>
                        <div class="size-chip" onclick="toggleSizeFilter('S')" data-size="S">S</div>
                        <div class="size-chip" onclick="toggleSizeFilter('M')" data-size="M">M</div>
                        <div class="size-chip" onclick="toggleSizeFilter('L')" data-size="L">L</div>
                        <div class="size-chip" onclick="toggleSizeFilter('XL')" data-size="XL">XL</div>
                        <div class="size-chip" onclick="toggleSizeFilter('XXL')" data-size="XXL">XXL</div>
                        <div class="size-chip" onclick="toggleSizeFilter('No-Size')" data-size="No-Size">No Size Data</div>
                    </div>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="clearFilters()">
                        üîÑ Clear All Filters
                    </button>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="card-title" style="margin: 0;">
                        <span class="card-icon">üë•</span>
                        All Students
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="toggleViewMode()">
                            üìã Table View
                        </button>
                        <button class="btn" onclick="loadStudents()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <div id="studentsContainer">
                    <div class="students-grid" id="studentsGrid">
                        <!-- Students will be loaded here -->
                    </div>
                    <div class="hidden" id="studentsTable">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Roll No.</th>
                                    <th>Name</th>
                                    <th>Class</th>
                                    <th>Gender</th>
                                    <th>Age</th>
                                    <th>Size</th>
                                    <th>Manufacturing Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <!-- Table data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="loadingIndicator" class="text-center mt-20 hidden">
                    <div class="loading"></div>
                    <p>Loading students...</p>
                </div>
            </div>
        </div>

        <!-- Tab: Delivery Tracking (New) -->
        <div class="tab-content" id="delivery-tracking">
            <!-- Delivery Summary -->
            <div class="delivery-summary-card">
                <div class="delivery-summary-content">
                    <h2 style="margin: 0 0 10px 0; font-size: 2rem;">üì¶ Delivery & Inventory Summary</h2>
                    <p style="margin: 0; opacity: 0.9; font-size: 1.1rem;">Track completed uniforms and deliveries back to school/college</p>
                    
                    <div class="delivery-stats">
                        <div class="delivery-stat">
                            <div class="delivery-stat-number" id="totalGarmentsProduced">0</div>
                            <div class="delivery-stat-label">Total Produced</div>
                        </div>
                        <div class="delivery-stat">
                            <div class="delivery-stat-number" id="totalGarmentsDelivered">0</div>
                            <div class="delivery-stat-label">Delivered to School</div>
                        </div>
                        <div class="delivery-stat">
                            <div class="delivery-stat-number" id="totalGarmentsDistributed">0</div>
                            <div class="delivery-stat-label">Distributed to Students</div>
                        </div>
                        <div class="delivery-stat">
                            <div class="delivery-stat-number" id="pendingDeliveries">0</div>
                            <div class="delivery-stat-label">Pending Delivery</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Individual Garment Tracking -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="card-title" style="margin: 0;">
                        <span class="card-icon">üëï</span>
                        Individual Garment Inventory
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="recordDelivery()">
                            üì¶ Record New Delivery
                        </button>
                        <button class="btn btn-outline" onclick="exportInventoryReport()">
                            üìä Export Report
                        </button>
                        <button class="btn" onclick="refreshInventory()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label>Filter by Category</label>
                            <select id="inventoryCategoryFilter" onchange="filterInventory()">
                                <option value="">All Categories</option>
                                <option value="formal">Formal Wear</option>
                                <option value="sports">Sports Wear</option>
                                <option value="accessories">Accessories</option>
                                <option value="outerwear">Outerwear</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filter by Status</label>
                            <select id="inventoryStatusFilter" onchange="filterInventory()">
                                <option value="">All Statuses</option>
                                <option value="manufacturing">In Manufacturing</option>
                                <option value="completed">Production Complete</option>
                                <option value="delivered">Delivered to School</option>
                                <option value="distributed">Distributed to Students</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filter by Size</label>
                            <select id="inventorySizeFilter" onchange="filterInventory()">
                                <option value="">All Sizes</option>
                                <option value="XS">Extra Small (XS)</option>
                                <option value="S">Small (S)</option>
                                <option value="M">Medium (M)</option>
                                <option value="L">Large (L)</option>
                                <option value="XL">Extra Large (XL)</option>
                                <option value="XXL">Double Extra Large (XXL)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="garmentInventoryContainer">
                    <div class="garment-inventory-grid" id="garmentInventoryGrid">
                        <!-- Garment inventory cards will be loaded here -->
                    </div>
                </div>

                <div id="inventoryLoadingIndicator" class="text-center mt-20 hidden">
                    <div class="loading"></div>
                    <p>Loading inventory data...</p>
                </div>
            </div>

            <!-- Recent Deliveries -->
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üöö</span>
                    Recent Deliveries
                </h2>
                
                <div id="recentDeliveriesTable">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Delivery Date</th>
                                <th>Garment Type</th>
                                <th>Quantity</th>
                                <th>Sizes</th>
                                <th>Batch ID</th>
                                <th>Quality Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentDeliveriesBody">
                            <!-- Recent deliveries will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="tab-content" id="manufacturing-tracking">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üè≠</span>
                    Manufacturing & Order Tracking
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">15</div>
                        <div class="stat-label">Orders Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">8</div>
                        <div class="stat-label">In Production</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">23</div>
                        <div class="stat-label">Quality Check</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">45</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>

                <div class="manufacturing-filters mb-20">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label>Filter by Status</label>
                            <select id="manufacturingStatusFilter" onchange="filterManufacturingOrders()">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending Approval</option>
                                <option value="approved">Approved</option>
                                <option value="in-progress">In Production</option>
                                <option value="quality-check">Quality Check</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filter by Priority</label>
                            <select id="priorityFilter" onchange="filterManufacturingOrders()">
                                <option value="">All Priorities</option>
                                <option value="urgent">Urgent</option>
                                <option value="high">High</option>
                                <option value="normal">Normal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="manufacturingOrdersTable">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Student Details</th>
                                <th>Garments</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Est. Completion</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="manufacturingTableBody">
                            <!-- Manufacturing data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Approvals (New) -->
        <div class="tab-content" id="approvals">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">‚úÖ</span>
                    Student Data Approvals for Manufacturing
                </h2>

                <div class="alert alert-info">
                    <span>‚ÑπÔ∏è</span>
                    <span>Review and approve student profiles before sending to tailoring company for uniform manufacturing.</span>
                </div>

                <div id="pendingApprovalsContainer">
                    <div class="students-grid" id="pendingApprovalsGrid">
                        <!-- Pending approvals will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Garment Management (New) -->
        <div class="tab-content" id="garment-management">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üëï</span>
                    Garment Management
                </h2>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <p>Manage uniform garments, names, and images</p>
                    <button class="btn btn-success" onclick="showModal('addGarmentModal')">
                        ‚ûï Add New Garment
                    </button>
                </div>

                <div class="garment-grid" id="garmentGrid">
                    <!-- Garments will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Tab: Search & Edit (Enhanced) -->
        <div class="tab-content" id="search-edit">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üîç</span>
                    Advanced Search & Edit
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Search Method</label>
                        <select id="searchMethod" onchange="updateSearchPlaceholder()">
                            <option value="general">General Search</option>
                            <option value="roll_number">By Roll Number</option>
                            <option value="reg_number">By Register Number</option>
                            <option value="name">By Name</option>
                            <option value="class_division">By Class & Division</option>
                            <option value="contact">By Parent Contact</option>
                            <option value="size">By Uniform Size</option>
                            <option value="manufacturing_status">By Manufacturing Status</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Search Term</label>
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="advancedSearchInput" placeholder="Enter search term...">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="performAdvancedSearch()">
                            üîç Search
                        </button>
                    </div>
                </div>

                <div id="searchResults" class="mt-20 hidden">
                    <h3>Search Results:</h3>
                    <div id="searchResultsContainer"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Reports (Enhanced) -->
        <div class="tab-content" id="reports">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üìà</span>
                    Advanced Reports & Analytics
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="class_wise">Class-wise Summary</option>
                            <option value="gender_wise">Gender-wise Distribution</option>
                            <option value="age_wise">Age Group Analysis</option>
                            <option value="size_distribution">Size Distribution Report</option>
                            <option value="manufacturing_status">Manufacturing Status Report</option>
                            <option value="pending_approvals">Pending Approvals Report</option>
                            <option value="inventory_summary">Garment Inventory Summary</option>
                            <option value="delivery_tracking">Delivery Tracking Report</option>
                            <option value="production_completion">Production Completion Report</option>
                            <option value="complete_list">Complete Student List</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Export Format</label>
                        <select id="exportFormat">
                            <option value="pdf">PDF Report</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="csv">CSV File</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="generateReport()">
                            üìä Generate Report
                        </button>
                    </div>
                </div>

                <div id="reportPreview" class="mt-20 hidden">
                    <h3>Report Preview:</h3>
                    <div id="reportContent"></div>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000; max-width: 400px;"></div>
    </div>

    <!-- Enhanced Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
            <h3>üì¢ Notifications</h3>
            <button onclick="toggleNotificationPanel()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">√ó</button>
        </div>
        <div class="notification-content" id="notificationContent">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    <!-- Edit Student Modal (Enhanced) -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Edit Student Profile</h2>
                <span class="close" onclick="closeModal('editStudentModal')">&times;</span>
            </div>
            <form id="editStudentForm">
                <input type="hidden" id="editStudentId" name="studentId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editRollNumber">Roll Number</label>
                        <input type="text" id="editRollNumber" name="rollNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="editRegNumber">Register Number</label>
                        <input type="text" id="editRegNumber" name="regNumber" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editStudentName">Student Name</label>
                    <input type="text" id="editStudentName" name="studentName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editClass">Class</label>
                        <input type="text" id="editClass" name="class" placeholder="Enter class" required>
                    </div>
                    <div class="form-group">
                        <label for="editDivision">Division</label>
                        <input type="text" id="editDivision" name="division" placeholder="Enter division" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editDob">Date of Birth</label>
                        <input type="date" id="editDob" name="dob" onchange="calculateEditAge()">
                    </div>
                    <div class="form-group">
                        <label for="editAge">Age</label>
                        <input type="number" id="editAge" name="age" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label>Gender</label>
                    <div class="gender-buttons">
                        <div class="gender-btn" onclick="selectEditGender('M')" data-gender="M">
                            üë¶ Male
                        </div>
                        <div class="gender-btn" onclick="selectEditGender('F')" data-gender="F">
                            üëß Female
                        </div>
                    </div>
                    <input type="hidden" id="editGender" name="gender">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editHeight" class="optional">Height (cm)</label>
                        <input type="number" id="editHeight" name="height" step="0.1" min="80" max="250">
                    </div>
                    <div class="form-group">
                        <label for="editWeight" class="optional">Weight (kg)</label>
                        <input type="number" id="editWeight" name="weight" step="0.1" min="10" max="200">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editParentContact" class="optional">Parent Contact</label>
                    <input type="tel" id="editParentContact" name="parentContact">
                </div>

                <div class="form-group">
                    <label for="editUniformSize" class="optional">Uniform Size</label>
                    <select id="editUniformSize" name="uniformSize">
                        <option value="">Auto-calculate</option>
                        <option value="XS">Extra Small (XS)</option>
                        <option value="S">Small (S)</option>
                        <option value="M">Medium (M)</option>
                        <option value="L">Large (L)</option>
                        <option value="XL">Extra Large (XL)</option>
                        <option value="XXL">Double Extra Large (XXL)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editAddress" class="optional">Address</label>
                    <textarea id="editAddress" name="address" rows="3"></textarea>
                </div>

                <div class="actions-grid">
                    <button type="submit" class="btn btn-success">
                        üíæ Update Student
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteStudent()">
                        üóëÔ∏è Delete Student
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('editStudentModal')">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Garment Modal -->
    <div id="addGarmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üëï Add New Garment</h2>
                <span class="close" onclick="closeModal('addGarmentModal')">&times;</span>
            </div>
            <form id="addGarmentForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="garmentName">Garment Name *</label>
                        <input type="text" id="garmentName" name="garmentName" placeholder="e.g., School Shirt, Blazer, Sports Shorts" required>
                    </div>
                    <div class="form-group">
                        <label for="garmentCategory">Category *</label>
                        <select id="garmentCategory" name="garmentCategory" required>
                            <option value="">Select Category</option>
                            <option value="formal">Formal Wear</option>
                            <option value="sports">Sports Wear</option>
                            <option value="accessories">Accessories</option>
                            <option value="outerwear">Outerwear</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="garmentGender">Gender *</label>
                        <select id="garmentGender" name="garmentGender" required>
                            <option value="">Select Gender</option>
                            <option value="unisex">Unisex</option>
                            <option value="male">Male Only</option>
                            <option value="female">Female Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="garmentPrice" class="optional">Price (‚Çπ)</label>
                        <input type="number" id="garmentPrice" name="garmentPrice" placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="garmentDescription" class="optional">Description</label>
                    <textarea id="garmentDescription" name="garmentDescription" rows="3" placeholder="Brief description of the garment"></textarea>
                </div>

                <div class="form-group">
                    <label for="garmentImage" class="optional">Garment Image</label>
                    <div class="file-upload-area" onclick="document.getElementById('garmentImageInput').click()">
                        <div class="upload-icon">üì∑</div>
                        <p>Click to upload image</p>
                        <p style="font-size: 0.8rem; color: var(--text-secondary);">Supported: JPG, PNG, GIF (Max 5MB)</p>
                        <input type="file" id="garmentImageInput" accept="image/*" style="display: none;" onchange="handleGarmentImageUpload(event)">
                    </div>
                    <div id="garmentImagePreview" class="hidden mt-20"></div>
                </div>

                <div class="actions-grid">
                    <button type="submit" class="btn btn-success">
                        üíæ Add Garment
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('addGarmentModal')">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Garment Modal -->
    <div id="editGarmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Edit Garment</h2>
                <span class="close" onclick="closeModal('editGarmentModal')">&times;</span>
            </div>
            <form id="editGarmentForm">
                <input type="hidden" id="editGarmentId" name="garmentId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editGarmentName">Garment Name *</label>
                        <input type="text" id="editGarmentName" name="garmentName" required>
                    </div>
                    <div class="form-group">
                        <label for="editGarmentCategory">Category *</label>
                        <select id="editGarmentCategory" name="garmentCategory" required>
                            <option value="formal">Formal Wear</option>
                            <option value="sports">Sports Wear</option>
                            <option value="accessories">Accessories</option>
                            <option value="outerwear">Outerwear</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editGarmentGender">Gender *</label>
                        <select id="editGarmentGender" name="garmentGender" required>
                            <option value="unisex">Unisex</option>
                            <option value="male">Male Only</option>
                            <option value="female">Female Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editGarmentPrice" class="optional">Price (‚Çπ)</label>
                        <input type="number" id="editGarmentPrice" name="garmentPrice" step="0.01" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editGarmentDescription" class="optional">Description</label>
                    <textarea id="editGarmentDescription" name="garmentDescription" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="editGarmentImage" class="optional">Update Image</label>
                    <div class="file-upload-area" onclick="document.getElementById('editGarmentImageInput').click()">
                        <div class="upload-icon">üì∑</div>
                        <p>Click to upload new image</p>
                        <input type="file" id="editGarmentImageInput" accept="image/*" style="display: none;" onchange="handleEditGarmentImageUpload(event)">
                    </div>
                    <div id="editGarmentImagePreview" class="mt-20"></div>
                </div>

                <div class="actions-grid">
                    <button type="submit" class="btn btn-success">
                        üíæ Update Garment
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteGarment()">
                        üóëÔ∏è Delete Garment
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('editGarmentModal')">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Record Delivery Modal -->
    <div id="recordDeliveryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì¶ Record New Delivery</h2>
                <span class="close" onclick="closeModal('recordDeliveryModal')">&times;</span>
            </div>
            <form id="recordDeliveryForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="deliveryDate">Delivery Date *</label>
                        <input type="date" id="deliveryDate" name="deliveryDate" required>
                    </div>
                    <div class="form-group">
                        <label for="deliveryBatchId">Batch ID *</label>
                        <input type="text" id="deliveryBatchId" name="deliveryBatchId" placeholder="e.g., BATCH-2024-001" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="deliveryGarmentType">Garment Type *</label>
                        <select id="deliveryGarmentType" name="deliveryGarmentType" required>
                            <option value="">Select Garment Type</option>
                            <option value="School Shirt - Boys">School Shirt - Boys</option>
                            <option value="School Shirt - Girls">School Shirt - Girls</option>
                            <option value="Trousers - Boys">Trousers - Boys</option>
                            <option value="Skirt - Girls">Skirt - Girls</option>
                            <option value="Blazer">School Blazer</option>
                            <option value="Sports Jersey">Sports Jersey</option>
                            <option value="Sports Shorts">Sports Shorts</option>
                            <option value="Cardigan">School Cardigan</option>
                            <option value="Tie">School Tie</option>
                            <option value="Belt">School Belt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deliveryCategory">Category *</label>
                        <select id="deliveryCategory" name="deliveryCategory" required>
                            <option value="">Select Category</option>
                            <option value="formal">Formal Wear</option>
                            <option value="sports">Sports Wear</option>
                            <option value="accessories">Accessories</option>
                            <option value="outerwear">Outerwear</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Size-wise Quantity *</label>
                    <div class="size-quantity-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-top: 10px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyXS" style="font-size: 0.9rem;">XS Quantity</label>
                            <input type="number" id="qtyXS" name="qtyXS" min="0" value="0" style="padding: 12px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyS" style="font-size: 0.9rem;">S Quantity</label>
                            <input type="number" id="qtyS" name="qtyS" min="0" value="0" style="padding: 12px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyM" style="font-size: 0.9rem;">M Quantity</label>
                            <input type="number" id="qtyM" name="qtyM" min="0" value="0" style="padding: 12px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyL" style="font-size: 0.9rem;">L Quantity</label>
                            <input type="number" id="qtyL" name="qtyL" min="0" value="0" style="padding: 12px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyXL" style="font-size: 0.9rem;">XL Quantity</label>
                            <input type="number" id="qtyXL" name="qtyXL" min="0" value="0" style="padding: 12px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="qtyXXL" style="font-size: 0.9rem;">XXL Quantity</label>
                            <input type="number" id="qtyXXL" name="qtyXXL" min="0" value="0" style="padding: 12px;">
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: var(--light-bg); border-radius: 8px;">
                        <strong>Total Quantity: </strong><span id="totalQuantity">0</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="qualityStatus">Quality Status *</label>
                        <select id="qualityStatus" name="qualityStatus" required>
                            <option value="">Select Quality Status</option>
                            <option value="excellent">Excellent Quality</option>
                            <option value="good">Good Quality</option>
                            <option value="acceptable">Acceptable Quality</option>
                            <option value="needs-review">Needs Quality Review</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deliveryStatus">Delivery Status *</label>
                        <select id="deliveryStatus" name="deliveryStatus" required>
                            <option value="">Select Status</option>
                            <option value="delivered">Delivered to School</option>
                            <option value="in-transit">In Transit</option>
                            <option value="ready-for-pickup">Ready for Pickup</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="deliveryNotes" class="optional">Delivery Notes</label>
                    <textarea id="deliveryNotes" name="deliveryNotes" rows="3" placeholder="Any additional notes about this delivery..."></textarea>
                </div>

                <div class="actions-grid">
                    <button type="submit" class="btn btn-success">
                        üíæ Record Delivery
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('recordDeliveryModal')">
                        ‚ùå Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div id="connectionStatus" class="connection-status connected">
        <div class="connection-indicator connected"></div>
        <span>AWS MySQL Connected</span>
    </div>

    <script>
        // Global variables
        let currentTheme = 'light';
        let allStudents = [];
        let filteredStudents = [];
        let allGarments = [];
        let manufacturingOrders = [];
        let pendingApprovals = [];
        let garmentInventory = [];
        let recentDeliveries = [];
        let selectedGender = '';
        let selectedEditGender = '';
        let currentViewMode = 'grid';
        let uploadedFile = null;
        let selectedSizes = [];
        let awsConnection = null;

        // AWS MySQL Configuration
        const awsConfig = {
            host: 'your-aws-rds-endpoint.amazonaws.com',
            database: 'uniform_smart_db',
            user: 'admin',
            password: 'your-password',
            port: 3306
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dob').max = today;
            document.getElementById('editDob').max = today;
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                toggleTheme();
            }
            
            // Initialize AWS connection
            initializeAWSConnection();
            
            // Load initial data
            loadStudents();
            loadGarments();
            loadManufacturingOrders();
            loadPendingApprovals();
            loadGarmentInventory();
            loadRecentDeliveries();
            loadStatistics();
            loadNotifications();
            
            setupFormHandlers();
            setupDragAndDropForBulkUpload();
        }

        // AWS MySQL Connection Functions
        async function initializeAWSConnection() {
            try {
                showAlert('Connecting to AWS MySQL database...', 'info');
                
                // Simulate connection attempt
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // In a real implementation, you would use a MySQL library
                // For demonstration, we'll simulate successful connection
                awsConnection = {
                    connected: true,
                    host: awsConfig.host,
                    database: awsConfig.database
                };
                
                updateConnectionStatus(true);
                showAlert('‚úÖ Successfully connected to AWS MySQL database', 'success');
                
            } catch (error) {
                console.error('AWS connection error:', error);
                updateConnectionStatus(false);
                showAlert('‚ùå Failed to connect to AWS database', 'error');
            }
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            const indicator = statusElement.querySelector('.connection-indicator');
            const text = statusElement.querySelector('span');
            
            if (connected) {
                statusElement.className = 'connection-status connected';
                indicator.className = 'connection-indicator connected';
                text.textContent = 'AWS MySQL Connected';
                document.getElementById('awsStatus').textContent = 'Connected';
            } else {
                statusElement.className = 'connection-status disconnected';
                indicator.className = 'connection-indicator disconnected';
                text.textContent = 'AWS MySQL Disconnected';
                document.getElementById('awsStatus').textContent = 'Disconnected';
            }
        }

        // Database Operations (AWS MySQL)
        async function saveToDatabase(table, data) {
            if (!awsConnection || !awsConnection.connected) {
                throw new Error('Database connection not available');
            }
            
            // In a real implementation, you would execute MySQL queries
            // For demonstration, we'll simulate the database operation
            try {
                showAlert('Saving to AWS MySQL database...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Simulate successful save
                console.log(`Saving to ${table}:`, data);
                return { success: true, id: Date.now() };
            } catch (error) {
                console.error('Database save error:', error);
                throw error;
            }
        }

        async function loadFromDatabase(table, conditions = {}) {
            if (!awsConnection || !awsConnection.connected) {
                return [];
            }
            
            try {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // For demonstration, return mock data
                // In real implementation, execute SELECT queries
                console.log(`Loading from ${table} with conditions:`, conditions);
                return [];
            } catch (error) {
                console.error('Database load error:', error);
                return [];
            }
        }

        function setupFormHandlers() {
            document.getElementById('studentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveStudent();
            });

            document.getElementById('editStudentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateStudent();
            });

            document.getElementById('addGarmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addGarment();
            });

            document.getElementById('recordDeliveryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                recordNewDelivery();
            });

            // Setup quantity calculation for delivery modal
            setupQuantityCalculation();

            document.getElementById('excelInput').addEventListener('change', handleFileUpload);
        }

        function setupDragAndDropForBulkUpload() {
            const uploadArea = document.querySelector('#bulk-upload .file-upload-area');
            
            if (uploadArea) {
                uploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        const fileInput = document.getElementById('excelInput');
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        fileInput.files = dataTransfer.files;
                        handleFileUpload({ target: { files: [file] } });
                    }
                });
            }
        }

        // Enhanced Notification System
        function loadNotifications() {
            const notifications = [
                {
                    id: 1,
                    type: 'manufacturing',
                    title: 'Manufacturing Update',
                    message: 'Batch #MFG-2024-001 has entered quality check phase',
                    time: '2 minutes ago',
                    priority: 'normal'
                },
                {
                    id: 2,
                    type: 'approval',
                    title: 'Pending Approval',
                    message: '15 student profiles awaiting approval for manufacturing',
                    time: '5 minutes ago',
                    priority: 'high'
                },
                {
                    id: 3,
                    type: 'completion',
                    title: 'Order Completed',
                    message: 'Uniform set for Class 10-A (25 students) ready for delivery',
                    time: '1 hour ago',
                    priority: 'normal'
                },
                {
                    id: 4,
                    type: 'manufacturing',
                    title: 'Production Delayed',
                    message: 'Batch #MFG-2024-002 delayed due to material shortage',
                    time: '2 hours ago',
                    priority: 'urgent'
                },
                {
                    id: 5,
                    type: 'approval',
                    title: 'Bulk Upload Success',
                    message: 'Successfully processed 45 student records from Excel import',
                    time: '3 hours ago',
                    priority: 'normal'
                }
            ];

            displayNotifications(notifications);
        }

        function displayNotifications(notifications) {
            const container = document.getElementById('notificationContent');
            container.innerHTML = '';

            notifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = `notification-item ${notification.type}`;
                
                const priorityIcon = notification.priority === 'urgent' ? 'üö®' : 
                                   notification.priority === 'high' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
                
                notificationElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                        <h5 style="margin: 0; color: var(--text-primary); display: flex; align-items: center; gap: 8px;">
                            ${priorityIcon} ${notification.title}
                        </h5>
                        <small style="color: var(--text-secondary);">${notification.time}</small>
                    </div>
                    <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">${notification.message}</p>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button class="btn btn-sm" onclick="markNotificationRead(${notification.id})">Mark Read</button>
                        <button class="btn btn-outline btn-sm" onclick="viewNotificationDetails(${notification.id})">View Details</button>
                    </div>
                `;
                
                container.appendChild(notificationElement);
            });
        }

        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('open');
        }

        function markNotificationRead(id) {
            showAlert('Notification marked as read', 'success');
            // Update notification count
            const currentCount = parseInt(document.getElementById('notificationCount').textContent);
            if (currentCount > 0) {
                document.getElementById('notificationCount').textContent = currentCount - 1;
            }
        }

        function viewNotificationDetails(id) {
            showAlert(`Viewing details for notification ${id}`, 'info');
        }

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '‚òÄÔ∏è Light Mode';
                currentTheme = 'dark';
            } else {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = 'üåô Dark Mode';
                currentTheme = 'light';
            }
            
            localStorage.setItem('theme', currentTheme);
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'view-students') {
                loadStudents();
            } else if (tabName === 'delivery-tracking') {
                loadGarmentInventory();
                loadRecentDeliveries();
            } else if (tabName === 'manufacturing-tracking') {
                loadManufacturingOrders();
            } else if (tabName === 'approvals') {
                loadPendingApprovals();
            } else if (tabName === 'garment-management') {
                loadGarments();
            }
        }

        // Gender Selection
        function selectGender(gender) {
            selectedGender = gender;
            document.getElementById('gender').value = gender;
            
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.querySelector(`[data-gender="${gender}"]`).classList.add('selected');
        }

        function selectEditGender(gender) {
            selectedEditGender = gender;
            document.getElementById('editGender').value = gender;
            
            document.querySelectorAll('#editStudentModal .gender-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.querySelector(`#editStudentModal [data-gender="${gender}"]`).classList.add('selected');
        }

        // Age Calculation
        function calculateAge() {
            const dob = document.getElementById('dob').value;
            if (dob) {
                const today = new Date();
                const birthDate = new Date(dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                document.getElementById('age').value = age;
            }
        }

        function calculateEditAge() {
            const dob = document.getElementById('editDob').value;
            if (dob) {
                const today = new Date();
                const birthDate = new Date(dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                document.getElementById('editAge').value = age;
            }
        }

        // Enhanced Size Filtering
        function toggleSizeFilter(size) {
            const chip = document.querySelector(`[data-size="${size}"]`);
            
            if (selectedSizes.includes(size)) {
                selectedSizes = selectedSizes.filter(s => s !== size);
                chip.classList.remove('selected');
            } else {
                selectedSizes.push(size);
                chip.classList.add('selected');
            }
            
            filterStudents();
        }

        // File Upload for Bulk
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const allowedTypes = [
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'text/csv'
                ];
                
                if (!allowedTypes.includes(file.type) && !file.name.toLowerCase().endsWith('.csv')) {
                    showAlert('Please select a valid Excel (.xlsx, .xls) or CSV file', 'error');
                    resetFileInput();
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) {
                    showAlert('File size should be less than 10MB', 'error');
                    resetFileInput();
                    return;
                }
                
                uploadedFile = file;
                displayFilePreview(file);
                document.getElementById('processBtn').disabled = false;
                showAlert(`File "${file.name}" selected successfully`, 'success');
            }
        }

        function displayFilePreview(file) {
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileDetails = document.getElementById('fileDetails');
            
            const fileSize = formatFileSize(file.size);
            const fileType = getFileTypeDisplay(file.name);
            
            fileName.textContent = file.name;
            fileDetails.innerHTML = `
                <strong>Type:</strong> ${fileType} | 
                <strong>Size:</strong> ${fileSize} | 
                <strong>Last Modified:</strong> ${new Date(file.lastModified).toLocaleDateString()}
            `;
            
            filePreview.classList.remove('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getFileTypeDisplay(fileName) {
            const extension = fileName.toLowerCase().split('.').pop();
            switch (extension) {
                case 'xlsx': return 'Excel Workbook (.xlsx)';
                case 'xls': return 'Excel 97-2003 (.xls)';
                case 'csv': return 'Comma Separated Values (.csv)';
                default: return 'Unknown';
            }
        }

        function removeFile() {
            resetFileInput();
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('processBtn').disabled = true;
        }

        function resetFileInput() {
            document.getElementById('excelInput').value = '';
            uploadedFile = null;
        }

        function resetUpload() {
            resetFileInput();
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
            document.getElementById('processBtn').disabled = true;
        }

        function processUploadedFile() {
            if (!uploadedFile) {
                showAlert('Please select a file first', 'error');
                return;
            }

            document.getElementById('uploadProgress').classList.remove('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
            document.getElementById('processBtn').disabled = true;
            
            const steps = [
                { progress: 10, text: 'Validating file format...' },
                { progress: 25, text: 'Reading file contents...' },
                { progress: 40, text: 'Parsing student data...' },
                { progress: 55, text: 'Validating student records...' },
                { progress: 70, text: 'Checking for duplicates...' },
                { progress: 85, text: 'Saving to AWS MySQL database...' },
                { progress: 95, text: 'Calculating uniform sizes...' },
                { progress: 100, text: 'Upload completed successfully!' }
            ];
            
            let currentStep = 0;
            
            const processStep = () => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    document.getElementById('progressFill').style.width = step.progress + '%';
                    document.getElementById('progressText').textContent = step.text;
                    currentStep++;
                    
                    const delay = currentStep <= 3 ? 300 : currentStep <= 6 ? 500 : 700;
                    setTimeout(processStep, delay);
                } else {
                    setTimeout(() => {
                        showUploadResults();
                    }, 500);
                }
            };
            
            processStep();
        }

        function showUploadResults() {
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.remove('hidden');
            
            const fileName = uploadedFile.name;
            const estimatedRecords = Math.floor(Math.random() * 50) + 10;
            const successCount = estimatedRecords - Math.floor(Math.random() * 3);
            const errorCount = estimatedRecords - successCount;
            
            const resultsHTML = `
                <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: var(--white-bg); border-radius: 8px; border: 2px solid var(--success-color);">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--success-color);">${successCount}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Successfully Added</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--white-bg); border-radius: 8px; border: 2px solid var(--danger-color);">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--danger-color);">${errorCount}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Errors/Duplicates</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--white-bg); border-radius: 8px; border: 2px solid var(--secondary-color);">
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--secondary-color);">${estimatedRecords}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Records</div>
                    </div>
                </div>
                
                <div style="background: var(--white-bg); padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary-color);">
                    <h5 style="margin: 0 0 10px 0; color: var(--text-primary);">üìÑ Processed File: ${fileName}</h5>
                    <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                        File processed successfully with ${successCount} students added to AWS MySQL database. 
                        ${errorCount > 0 ? `${errorCount} records had errors (likely duplicates or invalid data).` : 'All records processed without errors!'}
                    </p>
                </div>
                
                ${errorCount > 0 ? `
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning-color); margin-top: 15px;">
                    <h6 style="margin: 0 0 5px 0; color: #856404;">‚ö†Ô∏è Common Issues Found:</h6>
                    <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 0.9rem;">
                        <li>Duplicate roll numbers or register numbers</li>
                        <li>Invalid date formats (use YYYY-MM-DD)</li>
                        <li>Missing required fields</li>
                    </ul>
                </div>
                ` : ''}
            `;
            
            document.getElementById('resultsContent').innerHTML = resultsHTML;
            
            loadStudents();
            loadStatistics();
            
            showAlert(`‚úÖ Bulk upload completed! ${successCount} of ${estimatedRecords} students processed successfully.`, 'success');
        }

        // Save Student (Enhanced with AWS)
        async function saveStudent() {
            const formData = new FormData(document.getElementById('studentForm'));
            const studentData = Object.fromEntries(formData.entries());

            try {
                showAlert('Saving student profile to AWS database...', 'info');
                
                // Save to AWS MySQL database
                const result = await saveToDatabase('students', studentData);
                
                if (result.success) {
                    showAlert('‚úÖ Student profile saved successfully to AWS MySQL!', 'success');
                    loadStudents();
                    loadStatistics();
                    
                    setTimeout(() => {
                        if (confirm('Student saved successfully! Would you like to add another student?')) {
                            clearForm();
                        }
                    }, 2000);
                } else {
                    throw new Error('Database save failed');
                }
                
            } catch (error) {
                console.error('Error saving student:', error);
                showAlert('Error saving student profile to database. Please try again.', 'error');
            }
        }

        function saveAndAddNew() {
            saveStudent().then(() => {
                clearForm();
                showAlert('Ready to add new student', 'info');
            }).catch(error => {
                console.error('Error in save and add new:', error);
            });
        }

        // Clear Form
        function clearForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('age').value = '';
            document.getElementById('gender').value = '';
            selectedGender = '';
            
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            showAlert('Form cleared successfully', 'success');
        }

        // Load Students (Enhanced)
        async function loadStudents() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.classList.remove('hidden');
            
            try {
                // In real implementation, load from AWS MySQL
                const studentsFromDB = await loadFromDatabase('students');
                
                // Sample data for demonstration (replace with database results)
                allStudents = [
                    {
                        id: 1,
                        rollNumber: '2024001',
                        regNumber: 'REG001',
                        studentName: 'John Doe',
                        class: '10',
                        division: 'A',
                        dob: '2008-05-15',
                        age: 16,
                        gender: 'M',
                        height: 165,
                        weight: 55,
                        uniformSize: 'M',
                        parentContact: '9876543210',
                        address: '123 Main St, City',
                        status: 'Active',
                        manufacturingStatus: 'approved',
                        approvalStatus: 'approved'
                    },
                    {
                        id: 2,
                        rollNumber: '2024002',
                        regNumber: 'REG002',
                        studentName: 'Jane Smith',
                        class: '10',
                        division: 'A',
                        dob: '2008-03-20',
                        age: 16,
                        gender: 'F',
                        height: 160,
                        weight: 50,
                        uniformSize: 'S',
                        parentContact: '9876543211',
                        address: '456 Oak Ave, City',
                        status: 'Active',
                        manufacturingStatus: 'in-progress',
                        approvalStatus: 'approved'
                    },
                    {
                        id: 3,
                        rollNumber: '2024003',
                        regNumber: 'REG003',
                        studentName: 'Mike Johnson',
                        class: '9',
                        division: 'B',
                        dob: '2009-07-10',
                        age: 15,
                        gender: 'M',
                        height: 158,
                        weight: 48,
                        uniformSize: 'S',
                        parentContact: '9876543212',
                        address: '789 Pine Rd, City',
                        status: 'Active',
                        manufacturingStatus: 'pending',
                        approvalStatus: 'pending'
                    },
                    {
                        id: 4,
                        rollNumber: '2024004',
                        regNumber: 'REG004',
                        studentName: 'Emily Davis',
                        class: '11',
                        division: 'A',
                        dob: '2007-12-03',
                        age: 17,
                        gender: 'F',
                        height: null,
                        weight: null,
                        uniformSize: null,
                        parentContact: '9876543213',
                        address: '321 Elm St, City',
                        status: 'Active',
                        manufacturingStatus: 'pending',
                        approvalStatus: 'pending'
                    }
                ];
                
                filteredStudents = [...allStudents];
                displayStudents();
                populateFilterOptions();
                
            } catch (error) {
                console.error('Error loading students:', error);
                showAlert('Error loading students from database. Please try again.', 'error');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Display Students (Enhanced)
        function displayStudents() {
            if (currentViewMode === 'grid') {
                displayStudentsGrid();
            } else {
                displayStudentsTable();
            }
        }

        function displayStudentsGrid() {
            const container = document.getElementById('studentsGrid');
            container.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1/-1; color: var(--text-secondary); font-size: 1.2rem;">No students found</p>';
                return;
            }
            
            filteredStudents.forEach(student => {
                const sizeInfo = student.uniformSize ? `Size: ${student.uniformSize}` : 'Size: Not calculated';
                const heightWeight = (student.height && student.weight) ? 
                    `${student.height}cm | ${student.weight}kg` : 
                    'Measurements not provided';
                
                const manufacturingStatus = getManufacturingStatusBadge(student.manufacturingStatus);
                
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-info">
                            <h4>${student.studentName}</h4>
                            <div class="student-meta">
                                <strong>Roll:</strong> ${student.rollNumber}<br>
                                <strong>Class:</strong> ${student.class}-${student.division}<br>
                                <strong>Gender:</strong> ${student.gender === 'M' ? 'üë¶ Male' : 'üëß Female'}<br>
                                <strong>Age:</strong> ${student.age} years<br>
                                <strong>Physical:</strong> ${heightWeight}<br>
                                <strong>${sizeInfo}</strong>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            ${manufacturingStatus}
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="btn btn-sm" onclick="editStudent(${student.id})">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-success btn-sm" onclick="viewProfile(${student.id})">
                            üëÅÔ∏è View
                        </button>
                        ${student.approvalStatus === 'pending' ? 
                            `<button class="btn btn-warning btn-sm" onclick="approveStudent(${student.id})">‚úÖ Approve</button>` :
                            `<button class="btn btn-outline btn-sm" onclick="trackManufacturing(${student.id})">üè≠ Track</button>`
                        }
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function displayStudentsTable() {
            const tableBody = document.getElementById('studentsTableBody');
            tableBody.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="text-center" style="color: var(--text-secondary);">No students found</td></tr>';
                return;
            }
            
            filteredStudents.forEach(student => {
                const sizeDisplay = student.uniformSize || 'Not calculated';
                const manufacturingStatus = getManufacturingStatusBadge(student.manufacturingStatus);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${student.rollNumber}</strong></td>
                    <td>${student.studentName}</td>
                    <td>${student.class}-${student.division}</td>
                    <td>${student.gender === 'M' ? 'üë¶ Male' : 'üëß Female'}</td>
                    <td>${student.age}</td>
                    <td><strong>${sizeDisplay}</strong></td>
                    <td>${manufacturingStatus}</td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn btn-sm" onclick="editStudent(${student.id})" title="Edit">‚úèÔ∏è</button>
                            <button class="btn btn-success btn-sm" onclick="viewProfile(${student.id})" title="View">üëÅÔ∏è</button>
                            ${student.approvalStatus === 'pending' ? 
                                `<button class="btn btn-warning btn-sm" onclick="approveStudent(${student.id})" title="Approve">‚úÖ</button>` :
                                `<button class="btn btn-outline btn-sm" onclick="trackManufacturing(${student.id})" title="Track">üè≠</button>`
                            }
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function getManufacturingStatusBadge(status) {
            const statusConfig = {
                'pending': { class: 'pending', icon: '‚è≥', text: 'Pending' },
                'approved': { class: 'approved', icon: '‚úÖ', text: 'Approved' },
                'in-progress': { class: 'in-progress', icon: 'üè≠', text: 'In Production' },
                'quality-check': { class: 'in-progress', icon: 'üîç', text: 'Quality Check' },
                'completed': { class: 'completed', icon: '‚úÖ', text: 'Completed' }
            };
            
            const config = statusConfig[status] || { class: 'pending', icon: '‚è≥', text: 'Unknown' };
            
            return `<div class="manufacturing-status ${config.class}">
                ${config.icon} ${config.text}
            </div>`;
        }

        // Enhanced Filtering
        function populateFilterOptions() {
            const classes = [...new Set(allStudents.map(s => s.class))].sort();
            const divisions = [...new Set(allStudents.map(s => s.division))].sort();
            
            const classFilter = document.getElementById('classFilter');
            const divisionFilter = document.getElementById('divisionFilter');
            
            classFilter.innerHTML = '<option value="">All Classes</option>' +
                classes.map(c => `<option value="${c}">Class ${c}</option>`).join('');
            
            divisionFilter.innerHTML = '<option value="">All Divisions</option>' +
                divisions.map(d => `<option value="${d}">Division ${d}</option>`).join('');
        }

        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const genderFilter = document.getElementById('genderFilter').value;
            const classFilter = document.getElementById('classFilter').value;
            const divisionFilter = document.getElementById('divisionFilter').value;

            filteredStudents = allStudents.filter(student => {
                const matchesSearch = !searchTerm || 
                    student.studentName.toLowerCase().includes(searchTerm) ||
                    student.rollNumber.toLowerCase().includes(searchTerm) ||
                    student.regNumber.toLowerCase().includes(searchTerm);
                
                const matchesGender = !genderFilter || student.gender === genderFilter;
                const matchesClass = !classFilter || student.class === classFilter;
                const matchesDivision = !divisionFilter || student.division === divisionFilter;
                
                // Enhanced size filtering
                let matchesSize = true;
                if (selectedSizes.length > 0) {
                    if (selectedSizes.includes('No-Size')) {
                        matchesSize = selectedSizes.some(size => 
                            size === 'No-Size' ? !student.uniformSize : student.uniformSize === size
                        );
                    } else {
                        matchesSize = selectedSizes.includes(student.uniformSize);
                    }
                }
                
                return matchesSearch && matchesGender && matchesClass && matchesDivision && matchesSize;
            });

            displayStudents();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('genderFilter').value = '';
            document.getElementById('classFilter').value = '';
            document.getElementById('divisionFilter').value = '';
            
            // Clear size filters
            selectedSizes = [];
            document.querySelectorAll('.size-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            
            filteredStudents = [...allStudents];
            displayStudents();
            
            showAlert('All filters cleared', 'info');
        }

        // Toggle View Mode
        function toggleViewMode() {
            const button = event.target;
            const gridView = document.getElementById('studentsGrid');
            const tableView = document.getElementById('studentsTable');
            
            if (currentViewMode === 'grid') {
                currentViewMode = 'table';
                gridView.classList.add('hidden');
                tableView.classList.remove('hidden');
                button.innerHTML = 'üìã Grid View';
            } else {
                currentViewMode = 'grid';
                tableView.classList.add('hidden');
                gridView.classList.remove('hidden');
                button.innerHTML = 'üìã Table View';
            }
            
            displayStudents();
        }

        // Manufacturing Tracking Functions
        async function loadManufacturingOrders() {
            try {
                // In real implementation, load from AWS MySQL
                manufacturingOrders = [
                    {
                        id: 1,
                        orderId: 'MFG-2024-001',
                        studentName: 'John Doe',
                        class: '10-A',
                        garments: ['School Shirt', 'Trousers', 'Blazer'],
                        status: 'in-progress',
                        priority: 'normal',
                        estimatedCompletion: '2024-12-15',
                        actualCompletion: null
                    },
                    {
                        id: 2,
                        orderId: 'MFG-2024-002',
                        studentName: 'Jane Smith',
                        class: '10-A',
                        garments: ['School Shirt', 'Skirt', 'Cardigan'],
                        status: 'completed',
                        priority: 'high',
                        estimatedCompletion: '2024-12-10',
                        actualCompletion: '2024-12-09'
                    },
                    {
                        id: 3,
                        orderId: 'MFG-2024-003',
                        studentName: 'Mike Johnson',
                        class: '9-B',
                        garments: ['Sports Jersey', 'Sports Shorts'],
                        status: 'pending',
                        priority: 'urgent',
                        estimatedCompletion: '2024-12-20',
                        actualCompletion: null
                    }
                ];

                displayManufacturingOrders();
                
            } catch (error) {
                console.error('Error loading manufacturing orders:', error);
                showAlert('Error loading manufacturing data', 'error');
            }
        }

        function displayManufacturingOrders() {
            const tableBody = document.getElementById('manufacturingTableBody');
            tableBody.innerHTML = '';

            manufacturingOrders.forEach(order => {
                const statusBadge = getManufacturingStatusBadge(order.status);
                const priorityColor = order.priority === 'urgent' ? 'var(--danger-color)' : 
                                    order.priority === 'high' ? 'var(--warning-color)' : 
                                    'var(--success-color)';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${order.orderId}</strong></td>
                    <td>
                        <strong>${order.studentName}</strong><br>
                        <small>Class: ${order.class}</small>
                    </td>
                    <td>${order.garments.join(', ')}</td>
                    <td>${statusBadge}</td>
                    <td style="color: ${priorityColor}; font-weight: 600;">
                        ${order.priority.charAt(0).toUpperCase() + order.priority.slice(1)}
                    </td>
                    <td>${new Date(order.estimatedCompletion).toLocaleDateString()}</td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn btn-sm" onclick="viewOrderDetails(${order.id})">üëÅÔ∏è View</button>
                            <button class="btn btn-warning btn-sm" onclick="updateOrderStatus(${order.id})">üìù Update</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterManufacturingOrders() {
            // Implementation for filtering manufacturing orders
            showAlert('Manufacturing orders filtered', 'info');
        }

        function viewOrderDetails(orderId) {
            showAlert(`Viewing details for order ${orderId}`, 'info');
        }

        function updateOrderStatus(orderId) {
            showAlert(`Updating status for order ${orderId}`, 'info');
        }

        function trackManufacturing(studentId) {
            showAlert(`Tracking manufacturing for student ${studentId}`, 'info');
            showTab('manufacturing-tracking');
        }

        // Approval Functions
        async function loadPendingApprovals() {
            try {
                pendingApprovals = allStudents.filter(student => 
                    student.approvalStatus === 'pending'
                );

                displayPendingApprovals();
                
            } catch (error) {
                console.error('Error loading pending approvals:', error);
                showAlert('Error loading pending approvals', 'error');
            }
        }

        function displayPendingApprovals() {
            const container = document.getElementById('pendingApprovalsGrid');
            container.innerHTML = '';

            if (pendingApprovals.length === 0) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1/-1; color: var(--text-secondary); font-size: 1.2rem;">No pending approvals</p>';
                return;
            }

            pendingApprovals.forEach(student => {
                const heightWeight = (student.height && student.weight) ? 
                    `${student.height}cm | ${student.weight}kg` : 
                    'Measurements not provided';
                
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-info">
                            <h4>${student.studentName}</h4>
                            <div class="student-meta">
                                <strong>Roll:</strong> ${student.rollNumber}<br>
                                <strong>Class:</strong> ${student.class}-${student.division}<br>
                                <strong>Gender:</strong> ${student.gender === 'M' ? 'üë¶ Male' : 'üëß Female'}<br>
                                <strong>Age:</strong> ${student.age} years<br>
                                <strong>Physical:</strong> ${heightWeight}<br>
                                <strong>Contact:</strong> ${student.parentContact || 'Not provided'}
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div class="manufacturing-status pending">
                                ‚è≥ Pending Approval
                            </div>
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="btn btn-success" onclick="approveForManufacturing(${student.id})">
                            ‚úÖ Approve for Manufacturing
                        </button>
                        <button class="btn btn-warning" onclick="requestMoreInfo(${student.id})">
                            üìã Request More Info
                        </button>
                        <button class="btn btn-danger" onclick="rejectApproval(${student.id})">
                            ‚ùå Reject
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function approveForManufacturing(studentId) {
            try {
                showAlert('Approving student for manufacturing...', 'info');
                
                // Update in AWS database
                await saveToDatabase('students', { 
                    id: studentId, 
                    approvalStatus: 'approved',
                    manufacturingStatus: 'approved'
                });
                
                // Update local data
                const studentIndex = allStudents.findIndex(s => s.id === studentId);
                if (studentIndex !== -1) {
                    allStudents[studentIndex].approvalStatus = 'approved';
                    allStudents[studentIndex].manufacturingStatus = 'approved';
                }
                
                loadPendingApprovals();
                loadStudents();
                loadStatistics();
                
                showAlert('‚úÖ Student approved for manufacturing and sent to tailoring company!', 'success');
                
            } catch (error) {
                console.error('Error approving student:', error);
                showAlert('Error approving student. Please try again.', 'error');
            }
        }

        function requestMoreInfo(studentId) {
            showAlert(`Requesting more information for student ${studentId}`, 'info');
        }

        function rejectApproval(studentId) {
            if (confirm('Are you sure you want to reject this student approval?')) {
                showAlert(`Student ${studentId} approval rejected`, 'warning');
                loadPendingApprovals();
            }
        }

        // Garment Management Functions
        async function loadGarments() {
            try {
                // In real implementation, load from AWS MySQL
                allGarments = [
                    {
                        id: 1,
                        name: 'School Shirt - Boys',
                        category: 'formal',
                        gender: 'male',
                        price: 450.00,
                        description: 'White cotton school shirt for boys',
                        image: null
                    },
                    {
                        id: 2,
                        name: 'School Shirt - Girls',
                        category: 'formal',
                        gender: 'female',
                        price: 450.00,
                        description: 'White cotton school shirt for girls',
                        image: null
                    },
                    {
                        id: 3,
                        name: 'Sports Jersey',
                        category: 'sports',
                        gender: 'unisex',
                        price: 350.00,
                        description: 'Polyester sports jersey',
                        image: null
                    },
                    {
                        id: 4,
                        name: 'School Blazer',
                        category: 'outerwear',
                        gender: 'unisex',
                        price: 1250.00,
                        description: 'Navy blue school blazer',
                        image: null
                    }
                ];

                displayGarments();
                
            } catch (error) {
                console.error('Error loading garments:', error);
                showAlert('Error loading garment data', 'error');
            }
        }

        function displayGarments() {
            const container = document.getElementById('garmentGrid');
            container.innerHTML = '';

            allGarments.forEach(garment => {
                const card = document.createElement('div');
                card.className = 'garment-card';
                
                const genderIcon = garment.gender === 'male' ? 'üë¶' : 
                                 garment.gender === 'female' ? 'üëß' : 'üë´';
                
                card.innerHTML = `
                    <div class="garment-image">
                        ${garment.image ? `<img src="${garment.image}" alt="${garment.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">` : 'üëï'}
                    </div>
                    <div class="garment-name">${garment.name}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                        ${genderIcon} ${garment.gender.charAt(0).toUpperCase() + garment.gender.slice(1)} | 
                        ‚Çπ${garment.price.toFixed(2)}
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 15px;">
                        ${garment.description || 'No description available'}
                    </p>
                    <div class="garment-actions">
                        <button class="btn btn-sm" onclick="editGarment(${garment.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteGarment(${garment.id})">üóëÔ∏è Delete</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function handleGarmentImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('Image size should be less than 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('garmentImagePreview');
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 10px; box-shadow: var(--shadow);">
                            <p style="margin-top: 10px; color: var(--success-color);">Image selected successfully</p>
                        </div>
                    `;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                
                showAlert('Garment image selected successfully', 'success');
            }
        }

        function handleEditGarmentImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('Image size should be less than 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('editGarmentImagePreview');
                    preview.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${e.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 10px; box-shadow: var(--shadow);">
                            <p style="margin-top: 10px; color: var(--success-color);">New image selected</p>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
                
                showAlert('New garment image selected successfully', 'success');
            }
        }

        async function addGarment() {
            const formData = new FormData(document.getElementById('addGarmentForm'));
            const garmentData = Object.fromEntries(formData.entries());
            
            try {
                showAlert('Adding new garment...', 'info');
                
                // Save to AWS MySQL database
                const result = await saveToDatabase('garments', garmentData);
                
                if (result.success) {
                    showAlert('‚úÖ Garment added successfully!', 'success');
                    closeModal('addGarmentModal');
                    document.getElementById('addGarmentForm').reset();
                    document.getElementById('garmentImagePreview').classList.add('hidden');
                    loadGarments();
                } else {
                    throw new Error('Database save failed');
                }
                
            } catch (error) {
                console.error('Error adding garment:', error);
                showAlert('Error adding garment. Please try again.', 'error');
            }
        }

        function editGarment(garmentId) {
            const garment = allGarments.find(g => g.id === garmentId);
            if (!garment) {
                showAlert('Garment not found', 'error');
                return;
            }
            
            // Populate edit form
            document.getElementById('editGarmentId').value = garment.id;
            document.getElementById('editGarmentName').value = garment.name;
            document.getElementById('editGarmentCategory').value = garment.category;
            document.getElementById('editGarmentGender').value = garment.gender;
            document.getElementById('editGarmentPrice').value = garment.price;
            document.getElementById('editGarmentDescription').value = garment.description || '';
            
            // Show current image if exists
            const preview = document.getElementById('editGarmentImagePreview');
            if (garment.image) {
                preview.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${garment.image}" alt="${garment.name}" style="max-width: 200px; max-height: 200px; border-radius: 10px; box-shadow: var(--shadow);">
                        <p style="margin-top: 10px; color: var(--text-secondary);">Current image</p>
                    </div>
                `;
            } else {
                preview.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No current image</p>';
            }
            
            showModal('editGarmentModal');
        }

        async function updateGarment() {
            const formData = new FormData(document.getElementById('editGarmentForm'));
            const garmentData = Object.fromEntries(formData.entries());
            
            try {
                showAlert('Updating garment...', 'info');
                
                // Update in AWS MySQL database
                const result = await saveToDatabase('garments', garmentData);
                
                if (result.success) {
                    showAlert('‚úÖ Garment updated successfully!', 'success');
                    closeModal('editGarmentModal');
                    loadGarments();
                } else {
                    throw new Error('Database update failed');
                }
                
            } catch (error) {
                console.error('Error updating garment:', error);
                showAlert('Error updating garment. Please try again.', 'error');
            }
        }

        async function deleteGarment() {
            if (!confirm('Are you sure you want to delete this garment? This action cannot be undone.')) {
                return;
            }
            
            const garmentId = document.getElementById('editGarmentId').value;
            
            try {
                showAlert('Deleting garment...', 'warning');
                
                // Delete from AWS MySQL database
                await saveToDatabase('garments', { id: garmentId, action: 'delete' });
                
                showAlert('Garment deleted successfully', 'success');
                closeModal('editGarmentModal');
                loadGarments();
                
            } catch (error) {
                console.error('Error deleting garment:', error);
                showAlert('Error deleting garment. Please try again.', 'error');
            }
        }

        // Student Actions
        function editStudent(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) {
                showAlert('Student not found', 'error');
                return;
            }
            
            document.getElementById('editStudentId').value = student.id;
            document.getElementById('editRollNumber').value = student.rollNumber;
            document.getElementById('editRegNumber').value = student.regNumber;
            document.getElementById('editStudentName').value = student.studentName;
            document.getElementById('editClass').value = student.class;
            document.getElementById('editDivision').value = student.division;
            document.getElementById('editDob').value = student.dob;
            document.getElementById('editAge').value = student.age;
            document.getElementById('editHeight').value = student.height || '';
            document.getElementById('editWeight').value = student.weight || '';
            document.getElementById('editParentContact').value = student.parentContact || '';
            document.getElementById('editUniformSize').value = student.uniformSize || '';
            document.getElementById('editAddress').value = student.address || '';
            
            selectEditGender(student.gender);
            
            showModal('editStudentModal');
        }

        async function updateStudent() {
            const formData = new FormData(document.getElementById('editStudentForm'));
            const studentData = Object.fromEntries(formData.entries());
            
            try {
                showAlert('Updating student profile in AWS database...', 'info');
                
                const result = await saveToDatabase('students', studentData);
                
                if (result.success) {
                    showAlert('‚úÖ Student profile updated successfully!', 'success');
                    closeModal('editStudentModal');
                    loadStudents();
                    loadStatistics();
                } else {
                    throw new Error('Database update failed');
                }
                
            } catch (error) {
                console.error('Error updating student:', error);
                showAlert('Error updating student profile. Please try again.', 'error');
            }
        }

        async function deleteStudent() {
            if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                return;
            }
            
            const studentId = document.getElementById('editStudentId').value;
            
            try {
                showAlert('Deleting student from AWS database...', 'warning');
                
                await saveToDatabase('students', { id: studentId, action: 'delete' });
                
                showAlert('Student deleted successfully', 'success');
                closeModal('editStudentModal');
                loadStudents();
                loadStatistics();
                
            } catch (error) {
                console.error('Error deleting student:', error);
                showAlert('Error deleting student. Please try again.', 'error');
            }
        }

        function viewProfile(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) {
                showAlert('Student not found', 'error');
                return;
            }
            
            showAlert(`Viewing detailed profile for ${student.studentName}`, 'info');
        }

        async function approveStudent(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) {
                showAlert('Student not found', 'error');
                return;
            }
            
            if (confirm(`Approve ${student.studentName} for uniform manufacturing and send to tailoring company?`)) {
                try {
                    await approveForManufacturing(studentId);
                } catch (error) {
                    console.error('Error approving student:', error);
                    showAlert('Error approving student. Please try again.', 'error');
                }
            }
        }

        // Advanced Search (Enhanced)
        function updateSearchPlaceholder() {
            const method = document.getElementById('searchMethod').value;
            const input = document.getElementById('advancedSearchInput');
            
            const placeholders = {
                general: 'Enter any search term...',
                roll_number: 'Enter roll number (e.g., 2024001)',
                reg_number: 'Enter register number (e.g., REG001)',
                name: 'Enter student name',
                class_division: 'Enter class-division (e.g., 10-A)',
                contact: 'Enter parent contact number',
                size: 'Enter uniform size (XS, S, M, L, XL, XXL)',
                manufacturing_status: 'Enter status (pending, approved, in-progress, completed)'
            };
            
            input.placeholder = placeholders[method] || 'Enter search term...';
        }

        function performAdvancedSearch() {
            const method = document.getElementById('searchMethod').value;
            const searchTerm = document.getElementById('advancedSearchInput').value.trim();
            
            if (!searchTerm) {
                showAlert('Please enter a search term', 'warning');
                return;
            }
            
            showAlert('Searching...', 'info');
            
            setTimeout(() => {
                let results = [];
                
                switch (method) {
                    case 'roll_number':
                        results = allStudents.filter(s => 
                            s.rollNumber.toLowerCase().includes(searchTerm.toLowerCase())
                        );
                        break;
                    case 'reg_number':
                        results = allStudents.filter(s => 
                            s.regNumber.toLowerCase().includes(searchTerm.toLowerCase())
                        );
                        break;
                    case 'name':
                        results = allStudents.filter(s => 
                            s.studentName.toLowerCase().includes(searchTerm.toLowerCase())
                        );
                        break;
                    case 'class_division':
                        const [searchClass, searchDiv] = searchTerm.split('-');
                        results = allStudents.filter(s => 
                            s.class === searchClass && s.division === searchDiv?.toUpperCase()
                        );
                        break;
                    case 'contact':
                        results = allStudents.filter(s => 
                            s.parentContact && s.parentContact.includes(searchTerm)
                        );
                        break;
                    case 'size':
                        results = allStudents.filter(s => 
                            s.uniformSize && s.uniformSize.toLowerCase() === searchTerm.toLowerCase()
                        );
                        break;
                    case 'manufacturing_status':
                        results = allStudents.filter(s => 
                            s.manufacturingStatus && s.manufacturingStatus.toLowerCase().includes(searchTerm.toLowerCase())
                        );
                        break;
                    default:
                        results = allStudents.filter(s => 
                            s.studentName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            s.rollNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            s.regNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (s.uniformSize && s.uniformSize.toLowerCase().includes(searchTerm.toLowerCase())) ||
                            (s.manufacturingStatus && s.manufacturingStatus.toLowerCase().includes(searchTerm.toLowerCase()))
                        );
                }
                
                displaySearchResults(results);
                
            }, 500);
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResultsContainer');
            const searchResults = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<p class="text-center" style="color: var(--text-secondary);">No students found matching your search criteria.</p>';
            } else {
                container.innerHTML = results.map(student => {
                    const heightWeight = (student.height && student.weight) ? 
                        `${student.height}cm | ${student.weight}kg` : 
                        'Measurements not provided';
                    
                    const sizeInfo = student.uniformSize ? `Size: ${student.uniformSize}` : 'Size: Not calculated';
                    const manufacturingStatus = getManufacturingStatusBadge(student.manufacturingStatus);
                    
                    return `
                        <div class="student-card">
                            <div class="student-header">
                                <div class="student-info">
                                    <h4>${student.studentName}</h4>
                                    <div class="student-meta">
                                        <strong>Roll:</strong> ${student.rollNumber} | 
                                        <strong>Reg:</strong> ${student.regNumber}<br>
                                        <strong>Class:</strong> ${student.class}-${student.division} | 
                                        <strong>Gender:</strong> ${student.gender === 'M' ? 'Male' : 'Female'}<br>
                                        <strong>Age:</strong> ${student.age} | <strong>Physical:</strong> ${heightWeight}<br>
                                        <strong>${sizeInfo}</strong>
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    ${manufacturingStatus}
                                </div>
                            </div>
                            <div class="student-actions">
                                <button class="btn btn-sm" onclick="editStudent(${student.id})">‚úèÔ∏è Edit</button>
                                <button class="btn btn-success btn-sm" onclick="viewProfile(${student.id})">üëÅÔ∏è View</button>
                                ${student.approvalStatus === 'pending' ? 
                                    `<button class="btn btn-warning btn-sm" onclick="approveStudent(${student.id})">‚úÖ Approve</button>` :
                                    `<button class="btn btn-outline btn-sm" onclick="trackManufacturing(${student.id})">üè≠ Track</button>`
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            searchResults.classList.remove('hidden');
            showAlert(`Found ${results.length} student(s)`, 'success');
        }

        // Enhanced Reports
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const exportFormat = document.getElementById('exportFormat').value;
            
            showAlert('Generating enhanced report...', 'info');
            
            setTimeout(() => {
                const reportContent = document.getElementById('reportContent');
                const reportPreview = document.getElementById('reportPreview');
                
                let content = '';
                
                switch (reportType) {
                    case 'class_wise':
                        content = generateClassWiseReport();
                        break;
                    case 'gender_wise':
                        content = generateGenderWiseReport();
                        break;
                    case 'age_wise':
                        content = generateAgeWiseReport();
                        break;
                    case 'size_distribution':
                        content = generateSizeDistributionReport();
                        break;
                    case 'manufacturing_status':
                        content = generateManufacturingStatusReport();
                        break;
                    case 'pending_approvals':
                        content = generatePendingApprovalsReport();
                        break;
                    case 'inventory_summary':
                        content = generateInventorySummaryReport();
                        break;
                    case 'delivery_tracking':
                        content = generateDeliveryTrackingReport();
                        break;
                    case 'production_completion':
                        content = generateProductionCompletionReport();
                        break;
                    case 'complete_list':
                        content = generateCompleteListReport();
                        break;
                }
                
                reportContent.innerHTML = content;
                reportPreview.classList.remove('hidden');
                
                showAlert(`‚úÖ ${reportType.replace('_', ' ').toUpperCase()} report generated!`, 'success');
                
            }, 1000);
        }

        function generateClassWiseReport() {
            const classSummary = {};
            
            allStudents.forEach(student => {
                const key = `${student.class}-${student.division}`;
                if (!classSummary[key]) {
                    classSummary[key] = { total: 0, male: 0, female: 0, approved: 0, pending: 0 };
                }
                classSummary[key].total++;
                if (student.gender === 'M') {
                    classSummary[key].male++;
                } else {
                    classSummary[key].female++;
                }
                if (student.approvalStatus === 'approved') {
                    classSummary[key].approved++;
                } else {
                    classSummary[key].pending++;
                }
            });
            
            let html = '<table class="data-table"><thead><tr><th>Class</th><th>Total</th><th>Male</th><th>Female</th><th>Approved</th><th>Pending</th></tr></thead><tbody>';
            
            Object.entries(classSummary).forEach(([classDiv, data]) => {
                html += `<tr><td>${classDiv}</td><td>${data.total}</td><td>${data.male}</td><td>${data.female}</td><td>${data.approved}</td><td>${data.pending}</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateGenderWiseReport() {
            const male = allStudents.filter(s => s.gender === 'M').length;
            const female = allStudents.filter(s => s.gender === 'F').length;
            const total = allStudents.length;
            
            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${male}</div>
                        <div class="stat-label">Male Students (${((male/total)*100).toFixed(1)}%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${female}</div>
                        <div class="stat-label">Female Students (${((female/total)*100).toFixed(1)}%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${total}</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                </div>
            `;
        }

        function generateAgeWiseReport() {
            const ageGroups = {
                '5-8': 0, '9-12': 0, '13-15': 0, '16-18': 0
            };
            
            allStudents.forEach(student => {
                const age = student.age;
                if (age >= 5 && age <= 8) ageGroups['5-8']++;
                else if (age >= 9 && age <= 12) ageGroups['9-12']++;
                else if (age >= 13 && age <= 15) ageGroups['13-15']++;
                else if (age >= 16 && age <= 18) ageGroups['16-18']++;
            });
            
            let html = '<table class="data-table"><thead><tr><th>Age Group</th><th>Count</th><th>Percentage</th></tr></thead><tbody>';
            const total = allStudents.length;
            
            Object.entries(ageGroups).forEach(([group, count]) => {
                const percentage = ((count/total)*100).toFixed(1);
                html += `<tr><td>${group} years</td><td>${count}</td><td>${percentage}%</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateSizeDistributionReport() {
            const sizeGroups = { 'XS': 0, 'S': 0, 'M': 0, 'L': 0, 'XL': 0, 'XXL': 0, 'Not Calculated': 0 };
            
            allStudents.forEach(student => {
                if (student.uniformSize) {
                    sizeGroups[student.uniformSize]++;
                } else {
                    sizeGroups['Not Calculated']++;
                }
            });
            
            let html = '<table class="data-table"><thead><tr><th>Size</th><th>Count</th><th>Percentage</th></tr></thead><tbody>';
            const total = allStudents.length;
            
            Object.entries(sizeGroups).forEach(([size, count]) => {
                const percentage = ((count/total)*100).toFixed(1);
                html += `<tr><td>${size}</td><td>${count}</td><td>${percentage}%</td></tr>`;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateManufacturingStatusReport() {
            const statusGroups = { 'pending': 0, 'approved': 0, 'in-progress': 0, 'completed': 0 };
            
            allStudents.forEach(student => {
                if (student.manufacturingStatus) {
                    statusGroups[student.manufacturingStatus]++;
                } else {
                    statusGroups['pending']++;
                }
            });
            
            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${statusGroups.pending}</div>
                        <div class="stat-label">Pending Approval</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${statusGroups.approved}</div>
                        <div class="stat-label">Approved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${statusGroups['in-progress']}</div>
                        <div class="stat-label">In Production</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${statusGroups.completed}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
            `;
        }

        function generatePendingApprovalsReport() {
            const pending = allStudents.filter(s => s.approvalStatus === 'pending');
            
            if (pending.length === 0) {
                return '<p class="text-center">No pending approvals found.</p>';
            }
            
            let html = '<table class="data-table"><thead><tr><th>Roll No.</th><th>Name</th><th>Class</th><th>Gender</th><th>Size Status</th><th>Contact</th></tr></thead><tbody>';
            
            pending.forEach(student => {
                const sizeStatus = student.uniformSize ? student.uniformSize : 'Not Calculated';
                html += `
                    <tr>
                        <td>${student.rollNumber}</td>
                        <td>${student.studentName}</td>
                        <td>${student.class}-${student.division}</td>
                        <td>${student.gender === 'M' ? 'Male' : 'Female'}</td>
                        <td>${sizeStatus}</td>
                        <td>${student.parentContact || 'Not Provided'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateCompleteListReport() {
            let html = '<table class="data-table"><thead><tr><th>Roll No.</th><th>Name</th><th>Class</th><th>Gender</th><th>Age</th><th>Size</th><th>Manufacturing Status</th><th>Contact</th></tr></thead><tbody>';
            
            allStudents.forEach(student => {
                const sizeDisplay = student.uniformSize || 'Not Calculated';
                const statusDisplay = student.manufacturingStatus || 'Pending';
                
                html += `
                    <tr>
                        <td>${student.rollNumber}</td>
                        <td>${student.studentName}</td>
                        <td>${student.class}-${student.division}</td>
                        <td>${student.gender === 'M' ? 'Male' : 'Female'}</td>
                        <td>${student.age}</td>
                        <td>${sizeDisplay}</td>
                        <td>${statusDisplay}</td>
                        <td>${student.parentContact || 'N/A'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
        function generateInventorySummaryReport() {
            let html = '<div class="stats-grid" style="margin-bottom: 20px;">';
            
            const totalProduced = garmentInventory.reduce((sum, item) => sum + item.completed + item.delivered + item.distributed, 0);
            const totalDelivered = garmentInventory.reduce((sum, item) => sum + item.delivered + item.distributed, 0);
            const totalDistributed = garmentInventory.reduce((sum, item) => sum + item.distributed, 0);
            const pending = garmentInventory.reduce((sum, item) => sum + item.manufacturing, 0);
            
            html += `
                <div class="stat-card">
                    <div class="stat-number">${totalProduced}</div>
                    <div class="stat-label">Total Produced</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalDelivered}</div>
                    <div class="stat-label">Delivered to School</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalDistributed}</div>
                    <div class="stat-label">Distributed to Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${pending}</div>
                    <div class="stat-label">Still in Manufacturing</div>
                </div>
            </div>`;
            
            html += '<table class="data-table"><thead><tr><th>Garment Type</th><th>Category</th><th>Manufacturing</th><th>Completed</th><th>Delivered</th><th>Distributed</th><th>Last Delivery</th></tr></thead><tbody>';
            
            garmentInventory.forEach(item => {
                html += `
                    <tr>
                        <td>${item.garmentType}</td>
                        <td>${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</td>
                        <td>${item.manufacturing}</td>
                        <td>${item.completed}</td>
                        <td>${item.delivered}</td>
                        <td>${item.distributed}</td>
                        <td>${item.lastDelivery ? new Date(item.lastDelivery).toLocaleDateString() : 'N/A'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateDeliveryTrackingReport() {
            let html = '<h4>Recent Deliveries Summary</h4>';
            html += '<table class="data-table"><thead><tr><th>Date</th><th>Garment</th><th>Quantity</th><th>Size Breakdown</th><th>Quality</th><th>Batch ID</th></tr></thead><tbody>';
            
            recentDeliveries.forEach(delivery => {
                html += `
                    <tr>
                        <td>${new Date(delivery.deliveryDate).toLocaleDateString()}</td>
                        <td>${delivery.garmentType}</td>
                        <td><strong>${delivery.quantity}</strong></td>
                        <td style="font-size: 0.9rem;">${delivery.sizes}</td>
                        <td>${delivery.qualityStatus.charAt(0).toUpperCase() + delivery.qualityStatus.slice(1)}</td>
                        <td><code>${delivery.batchId}</code></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        function generateProductionCompletionReport() {
            let html = '<h4>Production Completion Status by Garment Type</h4>';
            
            // Calculate completion percentages
            const completionData = garmentInventory.map(item => {
                const totalOrdered = item.manufacturing + item.completed + item.delivered + item.distributed;
                const totalCompleted = item.completed + item.delivered + item.distributed;
                const completionPercentage = totalOrdered > 0 ? (totalCompleted / totalOrdered * 100).toFixed(1) : 0;
                
                return {
                    ...item,
                    totalOrdered,
                    totalCompleted,
                    completionPercentage
                };
            });
            
            html += '<table class="data-table"><thead><tr><th>Garment Type</th><th>Total Ordered</th><th>Completed</th><th>Back at School</th><th>Completion %</th><th>Status</th></tr></thead><tbody>';
            
            completionData.forEach(item => {
                const backAtSchool = item.delivered + item.distributed;
                const status = item.completionPercentage == 100 ? '‚úÖ Complete' : 
                             item.completionPercentage >= 75 ? 'üü° Nearly Complete' : 
                             item.completionPercentage >= 50 ? 'üü† In Progress' : 'üî¥ Starting';
                
                html += `
                    <tr>
                        <td>${item.garmentType}</td>
                        <td>${item.totalOrdered}</td>
                        <td>${item.totalCompleted}</td>
                        <td><strong>${backAtSchool}</strong></td>
                        <td><strong>${item.completionPercentage}%</strong></td>
                        <td>${status}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            // Add summary by category
            html += '<h4 style="margin-top: 30px;">Summary by Category</h4>';
            const categoryStats = {};
            
            garmentInventory.forEach(item => {
                if (!categoryStats[item.category]) {
                    categoryStats[item.category] = { delivered: 0, distributed: 0, total: 0 };
                }
                categoryStats[item.category].delivered += item.delivered;
                categoryStats[item.category].distributed += item.distributed;
                categoryStats[item.category].total += item.completed + item.delivered + item.distributed;
            });
            
            html += '<div class="stats-grid">';
            Object.entries(categoryStats).forEach(([category, stats]) => {
                html += `
                    <div class="stat-card">
                        <div class="stat-number">${stats.delivered + stats.distributed}</div>
                        <div class="stat-label">${category.charAt(0).toUpperCase() + category.slice(1)} Back at School</div>
                    </div>
                `;
            });
            html += '</div>';
            
            return html;
        }
            const total = allStudents.length;
            const male = allStudents.filter(s => s.gender === 'M').length;
            const pendingApprovals = allStudents.filter(s => s.approvalStatus === 'pending').length;
            const manufacturingOrders = allStudents.filter(s => s.manufacturingStatus === 'in-progress').length;
            const completedOrders = allStudents.filter(s => s.manufacturingStatus === 'completed').length;
            
            document.getElementById('totalStudents').textContent = total;
            document.getElementById('pendingApprovals').textContent = pendingApprovals;
            document.getElementById('manufacturingOrders').textContent = manufacturingOrders;
            document.getElementById('completedOrders').textContent = completedOrders;
            
            // Update notification count
            document.getElementById('notificationCount').textContent = pendingApprovals + 5; // 5 system notifications
        }

        // Utility Functions
        function downloadTemplate() {
            const headers = ['Roll Number', 'Register Number', 'Student Name', 'Class', 'Division', 'DOB (YYYY-MM-DD)', 'Gender (M/F)', 'Height (cm) - Optional', 'Weight (kg) - Optional'];
            const sampleData = ['2024001', 'REG001', 'John Doe', '10', 'A', '2008-05-15', 'M', '165', '55'];
            
            const csvContent = [headers.join(','), sampleData.join(',')].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'uniform_smart_student_template.csv';
            a.click();
            
            window.URL.revokeObjectURL(url);
            showAlert('Template downloaded successfully!', 'success');
        }

        // Modal Management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // Enhanced Alert System
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const alert = document.createElement('div');
            alert.id = alertId;
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span>${icons[type] || '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
                <button onclick="removeAlert('${alertId}')" style="background: none; border: none; color: inherit; font-size: 1.2rem; cursor: pointer; margin-left: auto;">&times;</button>
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => removeAlert(alertId), 5000);
        }

        function removeAlert(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100%)';
                setTimeout(() => alert.remove(), 300);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            });
            
            // Close notification panel when clicking outside
            const notificationPanel = document.getElementById('notificationPanel');
            if (!notificationPanel.contains(event.target) && !event.target.closest('.notification-btn')) {
                notificationPanel.classList.remove('open');
            }
        }

        // Enhanced Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab.id === 'student-entry') {
                    saveStudent();
                }
            }
            
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    closeModal(openModal.id);
                } else if (document.getElementById('notificationPanel').classList.contains('open')) {
                    toggleNotificationPanel();
                }
            }
            
            // Alt + N for notifications
            if (e.altKey && e.key === 'n') {
                e.preventDefault();
                toggleNotificationPanel();
            }
            
            // Alt + T for theme toggle
            if (e.altKey && e.key === 't') {
                e.preventDefault();
                toggleTheme();
            }
        });

        // Auto-save functionality for forms
        let autoSaveTimer;
        function setupAutoSave() {
            const forms = ['studentForm', 'editStudentForm'];
            
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    form.addEventListener('input', function() {
                        clearTimeout(autoSaveTimer);
                        autoSaveTimer = setTimeout(() => {
                            const formData = new FormData(form);
                            const data = Object.fromEntries(formData.entries());
                            localStorage.setItem(`${formId}_autosave`, JSON.stringify(data));
                        }, 2000);
                    });
                }
            });
        }

        // Load auto-saved data on page refresh
        function loadAutoSavedData() {
            const savedData = localStorage.getItem('studentForm_autosave');
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && data[key]) {
                        element.value = data[key];
                    }
                });
            }
        }

        // Periodic connection check
        setInterval(() => {
            if (awsConnection && awsConnection.connected) {
                // Simulate periodic connection check
                Math.random() > 0.95 ? updateConnectionStatus(false) : updateConnectionStatus(true);
            }
        }, 30000); // Check every 30 seconds

        // Initialize auto-save when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupAutoSave();
            loadAutoSavedData();
        });
    </script>
</body>
</html>
