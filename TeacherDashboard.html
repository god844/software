<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - Student Profile Entry</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #ecf0f1;
            --white-bg: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #bdc3c7;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        [data-theme="dark"] {
            --light-bg: #1a1a1a;
            --white-bg: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --primary-color: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-content h1 {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header-content p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--white-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--white-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .gender-buttons {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }

        .gender-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--border-color);
            background: var(--white-bg);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .gender-btn:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .gender-btn.selected {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .squad-colors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 8px;
        }

        .color-btn {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .color-red { background: #e74c3c; color: white; }
        .color-green { background: #27ae60; color: white; }
        .color-blue { background: #3498db; color: white; }
        .color-orange { background: #e67e22; color: white; }
        .color-yellow { background: #f1c40f; color: #2c3e50; }
        .color-pink { background: #e91e63; color: white; }

        .color-btn.selected {
            border-color: var(--text-primary);
            border-width: 3px;
            transform: scale(1.05);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-success { background: var(--success-color); }
        .btn-warning { background: var(--warning-color); }
        .btn-danger { background: var(--danger-color); }

        .photo-upload {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .photo-upload:hover {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.05);
        }

        .photo-upload.dragover {
            border-color: var(--success-color);
            background: rgba(39, 174, 96, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--white-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: var(--text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--danger-color);
        }

        .student-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .student-card {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .student-info h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .student-details {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--white-bg);
            color: var(--text-primary);
        }

        .bulk-upload {
            border: 2px dashed var(--secondary-color);
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }

        .size-chart {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .size-chart th, .size-chart td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        .size-chart th {
            background: var(--light-bg);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .squad-colors {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>üë®‚Äçüè´ Teacher Dashboard</h1>
                <p>Student Profile Management System</p>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()">
                    üåô Dark Mode
                </button>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard-grid">
            <!-- Student Profile Entry -->
            <div class="card">
                <h2 class="card-title">üë§ Student Profile Entry</h2>
                
                <div class="form-group">
                    <label for="rollNumber">Student Roll Number</label>
                    <input type="text" id="rollNumber" placeholder="Enter roll number">
                </div>

                <div class="form-group">
                    <label for="regNumber">School Register Number</label>
                    <input type="text" id="regNumber" placeholder="Enter register number">
                </div>

                <div class="form-group">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" placeholder="Enter full name">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="class">Class</label>
                        <input type="text" id="class" placeholder="e.g., 8, 10, 12">
                    </div>
                    <div class="form-group">
                        <label for="division">Division</label>
                        <input type="text" id="division" placeholder="e.g., A, B, C">
                    </div>
                </div>

                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" onchange="calculateAge()">
                </div>

                <div class="form-group">
                    <label>Gender</label>
                    <div class="gender-buttons">
                        <div class="gender-btn" onclick="selectGender('M')">
                            üë¶ Male
                        </div>
                        <div class="gender-btn" onclick="selectGender('F')">
                            üëß Female
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Squad Color</label>
                    <div class="squad-colors">
                        <div class="color-btn color-red" onclick="selectSquad('red')">üî¥ Red</div>
                        <div class="color-btn color-green" onclick="selectSquad('green')">üü¢ Green</div>
                        <div class="color-btn color-blue" onclick="selectSquad('blue')">üîµ Blue</div>
                        <div class="color-btn color-orange" onclick="selectSquad('orange')">üü† Orange</div>
                        <div class="color-btn color-yellow" onclick="selectSquad('yellow')">üü° Yellow</div>
                        <div class="color-btn color-pink" onclick="selectSquad('pink')">ü©∑ Pink</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="height">Height (cm)</label>
                        <input type="number" id="height" placeholder="e.g., 165" step="0.1" onchange="calculateMetrics()">
                    </div>
                    <div class="form-group">
                        <label for="weight">Weight (kg)</label>
                        <input type="number" id="weight" placeholder="e.g., 55.5" step="0.1" onchange="calculateMetrics()">
                    </div>
                </div>

                <div class="form-group">
                    <label for="age">Age (Auto-calculated)</label>
                    <input type="number" id="age" readonly style="background: var(--light-bg);">
                </div>
            </div>

            <!-- Photo Upload & Actions -->
            <div class="card">
                <h2 class="card-title">üì∏ Uniform Model Photo</h2>
                
                <div class="photo-upload" onclick="document.getElementById('photoInput').click()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üì∑</div>
                    <h3>Upload Uniform Model Photo</h3>
                    <p>Click here or drag & drop photo</p>
                    <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                </div>

                <div id="photoPreview" class="hidden" style="margin-top: 20px; text-align: center;">
                    <img id="previewImage" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                    <p style="margin-top: 10px; color: var(--success-color);">‚úÖ Photo uploaded successfully</p>
                </div>

                <div class="actions-grid">
                    <button class="btn btn-success" onclick="saveStudentProfile()">
                        üíæ Save Profile
                    </button>
                    <button class="btn btn-warning" onclick="clearForm()">
                        üîÑ Clear Form
                    </button>
                    <button class="btn" onclick="showAllStudents()">
                        üë• View All Students
                    </button>
                    <button class="btn" onclick="showBulkUpload()">
                        üìä Bulk Upload
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2 class="card-title">üöÄ Quick Actions</h2>
            <div class="actions-grid">
                <button class="btn" onclick="searchStudent()">
                    üîç Search Student
                </button>
                <button class="btn" onclick="editStudent()">
                    ‚úèÔ∏è Edit Student
                </button>
                <button class="btn btn-success" onclick="approveStudent()">
                    ‚úÖ Approve for Tailoring
                </button>
                <button class="btn" onclick="showSizeChart()">
                    üìè Size Chart Reference
                </button>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>
    </div>

    <!-- Students List Modal -->
    <div id="studentsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentsModal')">&times;</span>
            <h2>All Students</h2>
            
            <div class="filters">
                <select id="genderFilter" onchange="applyFilters()">
                    <option value="">All Genders</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                </select>
                <select id="classFilter" onchange="applyFilters()">
                    <option value="">All Classes</option>
                </select>
                <select id="divisionFilter" onchange="applyFilters()">
                    <option value="">All Divisions</option>
                </select>
                <select id="squadFilter" onchange="applyFilters()">
                    <option value="">All Squads</option>
                    <option value="red">Red</option>
                    <option value="green">Green</option>
                    <option value="blue">Blue</option>
                    <option value="orange">Orange</option>
                    <option value="yellow">Yellow</option>
                    <option value="pink">Pink</option>
                </select>
            </div>

            <div id="studentsList" class="student-list">
                <!-- Students will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bulkUploadModal')">&times;</span>
            <h2>üìä Bulk Student Upload</h2>
            
            <div class="bulk-upload">
                <h3>Upload Excel File</h3>
                <p>Upload an Excel file with student data</p>
                <input type="file" id="excelInput" accept=".xlsx,.xls" style="margin-top: 15px;">
                <button class="btn" onclick="processExcelFile()" style="margin-top: 15px;">
                    üì§ Process File
                </button>
            </div>

            <div style="margin-top: 30px;">
                <h3>Excel Format Required:</h3>
                <table class="size-chart">
                    <thead>
                        <tr>
                            <th>Roll Number</th>
                            <th>Register Number</th>
                            <th>Name</th>
                            <th>Class</th>
                            <th>Division</th>
                            <th>DOB (YYYY-MM-DD)</th>
                            <th>Gender (M/F)</th>
                            <th>Height (cm)</th>
                            <th>Weight (kg)</th>
                            <th>Squad Color</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2024001</td>
                            <td>REG001</td>
                            <td>John Doe</td>
                            <td>10</td>
                            <td>A</td>
                            <td>2008-05-15</td>
                            <td>M</td>
                            <td>165</td>
                            <td>55</td>
                            <td>blue</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Size Chart Modal -->
    <div id="sizeChartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sizeChartModal')">&times;</span>
            <h2>üìè Standard Size Chart</h2>
            
            <table class="size-chart">
                <thead>
                    <tr>
                        <th>Size</th>
                        <th>Chest (cm)</th>
                        <th>Waist (cm)</th>
                        <th>Hip (cm)</th>
                        <th>Shoulder (cm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Small-</strong></td>
                        <td>74-78</td>
                        <td>60-64</td>
                        <td>74-78</td>
                        <td>36-38</td>
                    </tr>
                    <tr>
                        <td><strong>Small+</strong></td>
                        <td>78-82</td>
                        <td>64-68</td>
                        <td>78-82</td>
                        <td>38-40</td>
                    </tr>
                    <tr>
                        <td><strong>Medium</strong></td>
                        <td>82-86</td>
                        <td>68-72</td>
                        <td>82-86</td>
                        <td>40-42</td>
                    </tr>
                    <tr>
                        <td><strong>Medium+</strong></td>
                        <td>86-90</td>
                        <td>72-76</td>
                        <td>86-90</td>
                        <td>42-44</td>
                    </tr>
                    <tr>
                        <td><strong>Large</strong></td>
                        <td>90-94</td>
                        <td>76-80</td>
                        <td>90-94</td>
                        <td>44-46</td>
                    </tr>
                    <tr>
                        <td><strong>Large+</strong></td>
                        <td>94-98</td>
                        <td>80-84</td>
                        <td>94-98</td>
                        <td>46-48</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Global variables
        let selectedGender = '';
        let selectedSquad = '';
        let uploadedPhoto = null;
        let currentTheme = 'light';
        let allStudents = [];
        const API_KEY = 'tailor_mgmt_sk_7f2d9e4a8c1b6h3j5k9m2p7q4r8s6t1x3z';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dob').max = today;
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                toggleTheme();
            }
        });

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '‚òÄÔ∏è Light Mode';
                currentTheme = 'dark';
            } else {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = 'üåô Dark Mode';
                currentTheme = 'light';
            }
            
            localStorage.setItem('theme', currentTheme);
        }

        // Gender selection
        function selectGender(gender) {
            selectedGender = gender;
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Squad selection
        function selectSquad(color) {
            selectedSquad = color;
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Calculate age
        function calculateAge() {
            const dob = document.getElementById('dob').value;
            if (dob) {
                const today = new Date();
                const birthDate = new Date(dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                document.getElementById('age').value = age;
            }
        }

        // Calculate metrics
        function calculateMetrics() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            
            if (height && weight) {
                const heightInMeters = height / 100;
                const bmi = weight / (heightInMeters * heightInMeters);
                // BMI is calculated but not shown to user as requested
                console.log('BMI calculated:', bmi.toFixed(2));
            }
        }

        // Photo upload handling
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedPhoto = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('photoPreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            event.target.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('photoInput').files = files;
                handlePhotoUpload({ target: { files: files } });
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.target.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.target.classList.remove('dragover');
        }

        // API request helper
        async function apiRequest(action, data = {}) {
            try {
                const response = await fetch('teacher_api.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        action: action,
                        ...data
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        }

        // Save student profile
        async function saveStudentProfile() {
            const studentData = {
                rollNumber: document.getElementById('rollNumber').value.trim(),
                regNumber: document.getElementById('regNumber').value.trim(),
                studentName: document.getElementById('studentName').value.trim(),
                studentClass: document.getElementById('class').value.trim(),
                division: document.getElementById('division').value.trim(),
                dob: document.getElementById('dob').value,
                gender: selectedGender,
                squadColor: selectedSquad,
                height: parseFloat(document.getElementById('height').value),
                weight: parseFloat(document.getElementById('weight').value),
                photo: uploadedPhoto
            };

            // Validation
            const errors = [];
            if (!studentData.rollNumber) errors.push('Roll Number is required');
            if (!studentData.regNumber) errors.push('Register Number is required');
            if (!studentData.studentName) errors.push('Student Name is required');
            if (!studentData.studentClass) errors.push('Class is required');
            if (!studentData.division) errors.push('Division is required');
            if (!studentData.dob) errors.push('Date of Birth is required');
            if (!studentData.gender) errors.push('Gender is required');
            if (!studentData.squadColor) errors.push('Squad Color is required');
            if (!studentData.height || studentData.height < 80 || studentData.height > 250) {
                errors.push('Height must be between 80-250 cm');
            }
            if (!studentData.weight || studentData.weight < 10 || studentData.weight > 200) {
                errors.push('Weight must be between 10-200 kg');
            }

            if (errors.length > 0) {
                showAlert(errors.join(', '), 'error');
                return;
            }

            try {
                const result = await apiRequest('saveStudentProfile', studentData);
                
                if (result.success) {
                    showAlert('‚úÖ Student profile saved successfully!', 'success');
                    setTimeout(() => {
                        if (confirm('Profile saved! Would you like to add another student?')) {
                            clearForm();
                        }
                    }, 1500);
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error. Please check your internet connection.', 'error');
            }
        }

        // Clear form
        function clearForm() {
            document.getElementById('rollNumber').value = '';
            document.getElementById('regNumber').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('class').value = '';
            document.getElementById('division').value = '';
            document.getElementById('dob').value = '';
            document.getElementById('height').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('age').value = '';
            
            selectedGender = '';
            selectedSquad = '';
            uploadedPhoto = null;
            
            document.querySelectorAll('.gender-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('photoPreview').classList.add('hidden');
            
            showAlert('Form cleared successfully', 'success');
        }

        // Show all students
        async function showAllStudents() {
            try {
                const result = await apiRequest('getAllStudents');
                
                if (result.success) {
                    allStudents = result.students;
                    displayStudents(allStudents);
                    populateFilterDropdowns();
                    document.getElementById('studentsModal').style.display = 'block';
                } else {
                    showAlert('Error loading students: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error while loading students', 'error');
            }
        }

        // Display students
        function displayStudents(students) {
            const studentsList = document.getElementById('studentsList');
            
            if (students.length === 0) {
                studentsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No students found</p>';
                return;
            }

            studentsList.innerHTML = students.map(student => `
                <div class="student-card">
                    <div class="student-info">
                        <h4>${student.student_name}</h4>
                        <div class="student-details">
                            Class: ${student.class}-${student.division} | 
                            ${student.gender === 'M' ? 'Male' : 'Female'} | 
                            Squad: ${student.squad_color} | 
                            ${student.height_cm}cm, ${student.weight_kg}kg | 
                            Status: ${getWorkflowStatus(student)}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="editStudentProfile('${student.roll_number}')">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-success" onclick="approveForTailoring('${student.roll_number}')">
                            üßµ Send to Tailor
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Populate filter dropdowns
        function populateFilterDropdowns() {
            const classes = [...new Set(allStudents.map(s => s.class))].sort();
            const divisions = [...new Set(allStudents.map(s => s.division))].sort();
            
            document.getElementById('classFilter').innerHTML = '<option value="">All Classes</option>' +
                classes.map(c => `<option value="${c}">${c}</option>`).join('');
            
            document.getElementById('divisionFilter').innerHTML = '<option value="">All Divisions</option>' +
                divisions.map(d => `<option value="${d}">${d}</option>`).join('');
        }

        // Apply filters
        function applyFilters() {
            const genderFilter = document.getElementById('genderFilter').value;
            const classFilter = document.getElementById('classFilter').value;
            const divisionFilter = document.getElementById('divisionFilter').value;
            const squadFilter = document.getElementById('squadFilter').value;

            const filteredStudents = allStudents.filter(student => {
                return (!genderFilter || student.gender === genderFilter) &&
                       (!classFilter || student.class === classFilter) &&
                       (!divisionFilter || student.division === divisionFilter) &&
                       (!squadFilter || student.squad_color === squadFilter);
            });

            displayStudents(filteredStudents);
        }

        // Search student
        async function searchStudent() {
            const searchTerm = prompt('Enter Roll Number, Register Number, or Name to search:');
            if (!searchTerm || searchTerm.trim() === '') {
                return;
            }

            try {
                const result = await apiRequest('searchStudents', {
                    searchTerm: searchTerm.trim()
                });

                if (result.success) {
                    if (result.students.length === 0) {
                        showAlert('No students found matching your search', 'warning');
                        return;
                    }

                    allStudents = result.students;
                    displayStudents(allStudents);
                    document.getElementById('studentsModal').style.display = 'block';
                } else {
                    showAlert('Search error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error during search', 'error');
            }
        }

        // Edit student
        function editStudent() {
            showAlert('Please use the Search Student option and then click Edit on the student you want to modify', 'warning');
        }

        // Edit student profile
        async function editStudentProfile(rollNumber) {
            try {
                const result = await apiRequest('getStudent', { rollNumber: rollNumber });

                if (result.success) {
                    const student = result.student;
                    
                    // Fill form with student data
                    document.getElementById('rollNumber').value = student.roll_number;
                    document.getElementById('regNumber').value = student.reg_number;
                    document.getElementById('studentName').value = student.student_name;
                    document.getElementById('class').value = student.class;
                    document.getElementById('division').value = student.division;
                    document.getElementById('dob').value = student.dob;
                    document.getElementById('height').value = student.height_cm;
                    document.getElementById('weight').value = student.weight_kg;
                    document.getElementById('age').value = student.age;

                    // Set gender and squad
                    selectGender(student.gender);
                    selectSquad(student.squad_color);

                    closeModal('studentsModal');
                    showAlert(`Student "${student.student_name}" loaded for editing`, 'success');
                } else {
                    showAlert('Error loading student: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error while loading student', 'error');
            }
        }

        // Approve for tailoring (Updated for new workflow)
        async function approveForTailoring(rollNumber) {
            if (!confirm('Send this student to tailor for measurements?')) {
                return;
            }

            try {
                const result = await apiRequest('sendToTailor', { rollNumber: rollNumber });
                
                if (result.success) {
                    showAlert('‚úÖ Student sent to tailor queue!', 'success');
                    showAllStudents(); // Refresh the list
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error', 'error');
            }
        }

        // Get workflow status for display
        function getWorkflowStatus(student) {
            if (student.company_production_status === 'delivered') {
                return 'üì¶ Delivered';
            } else if (student.company_production_status === 'in_production') {
                return 'üè≠ In Production';
            } else if (student.teacher_review_status === 'approved') {
                return '‚úÖ Approved';
            } else if (student.tailor_data_entry_status === 'completed') {
                return 'üìê Pending Review';
            } else if (student.tailor_data_entry_status === 'in_progress') {
                return 'üßµ Measuring';
            } else if (student.tailor_data_entry_status === 'pending') {
                return '‚è≥ Ready for Tailor';
            } else {
                return 'üìù Profile Created';
            }
        }

        // Show size chart
        function showSizeChart() {
            document.getElementById('sizeChartModal').style.display = 'block';
        }

        // Show bulk upload
        function showBulkUpload() {
            document.getElementById('bulkUploadModal').style.display = 'block';
        }

        // Process Excel file
        async function processExcelFile() {
            const fileInput = document.getElementById('excelInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select an Excel file', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('excel_file', file);
                formData.append('action', 'bulkUpload');

                const response = await fetch('teacher_api.php', {
                    method: 'POST',
                    headers: {
                        'X-API-Key': API_KEY
                    },
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    showAlert(`‚úÖ Successfully uploaded ${result.count} students!`, 'success');
                    closeModal('bulkUploadModal');
                } else {
                    showAlert('Upload error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Connection error during upload', 'error');
            }
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Show alerts
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();
            
            alertContainer.innerHTML = `
                <div id="${alertId}" class="alert alert-${type}">
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) alert.remove();
            }, 5000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['studentsModal', 'bulkUploadModal', 'sizeChartModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>