.btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniform Specification - QR Scanner Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .scanner-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .scanner-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scanner-placeholder {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            color: #666;
        }

        .scanner-placeholder svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .manual-input {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .manual-input textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 150px;
            transition: all 0.3s;
        }

        .manual-input textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .result-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .result-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spec-card {
            background: linear-gradient(135deg, #f8f9ff, #fff);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e6ff;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .spec-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .spec-title h3 {
            color: #333;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .spec-title p {
            color: #666;
            font-size: 0.95rem;
        }

        .spec-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .spec-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .spec-item {
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .spec-item label {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .spec-item .value {
            color: #333;
            font-size: 1.05rem;
            font-weight: 600;
        }

        .timestamp-info {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timestamp-info .time {
            color: #666;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .history-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .history-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .history-item {
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
            border: 2px solid #e0e6ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .history-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .history-item p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.ready {
            background: #10b981;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #10b981;
            color: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: slideInRight 0.3s ease-out;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.error {
            background: #ef4444;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .spec-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }

        @media print {
            body {
                background: white;
            }
            .header,
            .scanner-section,
            .history-section,
            .action-buttons,
            .manual-input {
                display: none;
            }
            .main-grid {
                display: block;
            }
            .spec-card {
                box-shadow: none;
                border: 2px solid #333;
            }
        }

        @keyframes scan {
            0% { top: 0; }
            50% { top: calc(100% - 2px); }
            100% { top: 0; }
        }

        .file-upload {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-label {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>📋 Uniform Specification Scanner</h1>
            <p>Scan QR codes from magic cards to view detailed specifications</p>
        </div>

        <div class="main-grid">
            <div class="scanner-section">
                <h2>
                    <span class="status-indicator ready"></span>
                    QR Code Scanner
                </h2>
                
                <div class="scanner-placeholder" id="scannerContainer" style="position: relative;">
                    <video id="video" style="width: 100%; border-radius: 10px; display: none;"></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                    <div id="scanningOverlay" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                        <div style="width: 200px; height: 200px; border: 3px solid #10b981; border-radius: 20px; position: relative;">
                            <div style="position: absolute; top: -10px; left: -10px; width: 30px; height: 30px; border-top: 4px solid #10b981; border-left: 4px solid #10b981;"></div>
                            <div style="position: absolute; top: -10px; right: -10px; width: 30px; height: 30px; border-top: 4px solid #10b981; border-right: 4px solid #10b981;"></div>
                            <div style="position: absolute; bottom: -10px; left: -10px; width: 30px; height: 30px; border-bottom: 4px solid #10b981; border-left: 4px solid #10b981;"></div>
                            <div style="position: absolute; bottom: -10px; right: -10px; width: 30px; height: 30px; border-bottom: 4px solid #10b981; border-right: 4px solid #10b981;"></div>
                            <div id="scanLine" style="position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: #10b981; animation: scan 2s linear infinite;"></div>
                        </div>
                        <p style="color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-top: 20px; font-weight: bold;">Scanning...</p>
                    </div>
                    <div id="scannerPlaceholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="9" x2="9" y2="9.01"></line>
                            <line x1="15" y1="9" x2="15" y2="9.01"></line>
                            <line x1="9" y1="15" x2="9" y2="15.01"></line>
                            <line x1="15" y1="15" x2="15" y2="15.01"></line>
                        </svg>
                        <h3>QR Code Camera Scanner</h3>
                        <p style="color: #dc3545; font-weight: bold; margin: 10px 0;">⚠️ Camera Note:</p>
                        <p style="font-size: 0.9rem; color: #666;">Camera access requires HTTPS or localhost connection</p>
                        <button class="btn btn-primary" onclick="startCamera()" style="margin-top: 20px;">
                            📷 Try Camera Scanner
                        </button>
                        <p style="margin-top: 15px; font-size: 0.85rem; color: #999;">If camera doesn't work, use the alternatives below</p>
                    </div>
                    <div id="scannerResult" style="display: none; margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px; color: #2e7d32;">
                        <strong>✅ QR Code Detected!</strong>
                        <p id="scannerResultText"></p>
                    </div>
                    <button class="btn btn-danger" id="stopButton" onclick="stopCamera()" style="display: none; margin-top: 20px;">
                        ⏹️ Stop Camera
                    </button>
                </div>
                
                <div class="file-upload">
                    <h3 style="margin-bottom: 15px; color: #333;">Upload QR Code Image:</h3>
                    <input type="file" id="qrFileInput" accept="image/*" onchange="handleFileUpload(event)">
                    <label for="qrFileInput" class="file-upload-label">
                        📷 Choose QR Code Image
                    </label>
                </div>
                
                <div class="manual-input">
                    <h3 style="margin-bottom: 15px; color: #333;">Or paste QR code data manually:</h3>
                    <textarea id="manualData" placeholder='Paste JSON data here, e.g., {"type":"shirt","item":"Boys Half-sleeve Formal Shirt"...}'></textarea>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="processManualData()">
                            📊 Process Data
                        </button>
                        <button class="btn btn-secondary" onclick="loadSampleData()">
                            📝 Load Sample Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="result-section">
                <h2>
                    📋 Specification Details
                </h2>
                
                <div id="resultContainer">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                            <path d="M9 6h6M9 10h6M9 14h4"></path>
                        </svg>
                        <h3>No data scanned yet</h3>
                        <p>Upload an image, paste data, or load sample to view specifications</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="history-section">
            <h2>📜 Recent Scans</h2>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <p style="color: #666;">Your scan history is saved locally</p>
                <button class="btn btn-secondary" onclick="clearHistory()" style="padding: 8px 16px; font-size: 0.9rem;">
                    🗑️ Clear History
                </button>
            </div>
            <div class="history-grid" id="historyContainer">
                <p style="color: #999; text-align: center; grid-column: 1/-1;">No scan history available</p>
            </div>
        </div>
    </div>

    <script>
        let scanHistory = [];
        let video = null;
        let canvas = null;
        let canvasContext = null;
        let scanning = false;

        // Start camera for QR scanning
        function startCamera() {
            // Check if we're on HTTPS or localhost (camera requires secure context)
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            
            if (!isSecure && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // Show detailed message about HTTPS requirement
                showNotification('Camera access requires HTTPS connection. Please use manual input or file upload instead.', 'error');
                document.getElementById('scannerPlaceholder').innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="9" y1="9" x2="9" y2="9.01"></line>
                        <line x1="15" y1="9" x2="15" y2="9.01"></line>
                        <line x1="9" y1="15" x2="9" y2="15.01"></line>
                        <line x1="15" y1="15" x2="15" y2="15.01"></line>
                    </svg>
                    <h3 style="color: #dc3545;">Camera Requires Secure Connection</h3>
                    <p style="margin: 15px 0;">For security reasons, camera access is only available on:</p>
                    <ul style="text-align: left; display: inline-block; margin: 10px 0;">
                        <li>HTTPS websites (https://...)</li>
                        <li>Localhost (for development)</li>
                    </ul>
                    <p style="margin-top: 15px; font-weight: bold; color: #667eea;">Please use one of these alternatives:</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="document.getElementById('qrFileInput').click()">
                            📁 Upload QR Image
                        </button>
                        <button class="btn btn-secondary" onclick="document.getElementById('manualData').focus()">
                            ⌨️ Manual Input
                        </button>
                    </div>
                `;
                return;
            }

            // Check if getUserMedia is available
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('Camera API not supported in this browser. Please use manual input.', 'error');
                return;
            }

            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            canvasContext = canvas.getContext('2d');

            // Hide placeholder and show video
            document.getElementById('scannerPlaceholder').style.display = 'none';
            video.style.display = 'block';
            document.getElementById('stopButton').style.display = 'inline-block';
            
            // Access user camera with optimized settings
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment', // Use back camera on mobile
                    width: { ideal: 1280 },    // Higher resolution for better detection
                    height: { ideal: 720 },
                    frameRate: { ideal: 30 }    // Higher frame rate
                } 
            })
            .then(function(stream) {
                video.srcObject = stream;
                video.setAttribute('playsinline', true); // Required for iOS Safari
                video.play();
                scanning = true;
                
                // Show scanning overlay
                document.getElementById('scanningOverlay').style.display = 'block';
                
                // Start continuous scanning
                scanContinuously();
                showNotification('Camera started. Align QR code within the frame.');
            })
            .catch(function(err) {
                console.error('Camera error:', err);
                let errorMessage = 'Camera access denied or not available.';
                
                if (err.name === 'NotAllowedError') {
                    errorMessage = 'Camera permission denied. Please allow camera access and try again.';
                } else if (err.name === 'NotFoundError') {
                    errorMessage = 'No camera found on this device.';
                } else if (err.name === 'NotReadableError') {
                    errorMessage = 'Camera is already in use by another application.';
                } else if (err.name === 'SecurityError') {
                    errorMessage = 'Camera access requires HTTPS connection. Use manual input instead.';
                }
                
                showNotification(errorMessage, 'error');
                stopCamera();
                
                // Update placeholder with error info
                document.getElementById('scannerPlaceholder').innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="#dc3545" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12" y2="16.01"></line>
                    </svg>
                    <h3>Camera Not Available</h3>
                    <p style="color: #dc3545; margin: 10px 0;">${errorMessage}</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 15px;">
                        🔄 Reload & Try Again
                    </button>
                `;
            });
        }

        // Stop camera
        function stopCamera() {
            scanning = false;
            
            if (video && video.srcObject) {
                const stream = video.srcObject;
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
            }

            // Hide scanning overlay
            document.getElementById('scanningOverlay').style.display = 'none';
            
            // Show placeholder and hide video
            document.getElementById('scannerPlaceholder').style.display = 'block';
            document.getElementById('video').style.display = 'none';
            document.getElementById('stopButton').style.display = 'none';
            document.getElementById('scannerResult').style.display = 'none';
        }

        // QR Code scanning loop - Optimized for speed
        function tick() {
            if (!scanning) return;
            
            if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
                // Dynamically adjust canvas size for better performance
                const width = 320; // Reduced resolution for faster processing
                const height = (video.videoHeight / video.videoWidth) * width;
                
                canvas.width = width;
                canvas.height = height;
                canvasContext.drawImage(video, 0, 0, width, height);
                
                const imageData = canvasContext.getImageData(0, 0, width, height);
                
                // Use jsQR with multiple inversion attempts for better detection
                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: "attemptBoth" // Try both normal and inverted for better detection
                });
                
                if (code && code.data) {
                    // Draw detection box for visual feedback
                    drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#10b981");
                    drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#10b981");
                    drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#10b981");
                    drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#10b981");
                    
                    console.log("QR Code detected:", code.data);
                    handleQRCodeData(code.data);
                } else {
                    // Show scanning indicator
                    updateScanningIndicator();
                }
            }
            
            // Faster frame rate for quicker detection
            setTimeout(() => {
                requestAnimationFrame(tick);
            }, 100); // Scan 10 times per second for balance between speed and performance
        }

        // Draw line for QR code detection visualization
        function drawLine(begin, end, color) {
            const canvasElement = document.getElementById('video-canvas');
            if (!canvasElement) {
                // Create overlay canvas for drawing
                const overlay = document.createElement('canvas');
                overlay.id = 'video-canvas';
                overlay.style.position = 'absolute';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.width = '100%';
                overlay.style.height = '100%';
                overlay.style.pointerEvents = 'none';
                video.parentElement.appendChild(overlay);
            }
            
            const overlayCanvas = document.getElementById('video-canvas');
            const ctx = overlayCanvas.getContext('2d');
            overlayCanvas.width = video.videoWidth;
            overlayCanvas.height = video.videoHeight;
            
            ctx.beginPath();
            ctx.moveTo(begin.x, begin.y);
            ctx.lineTo(end.x, end.y);
            ctx.lineWidth = 4;
            ctx.strokeStyle = color;
            ctx.stroke();
        }

        // Update scanning indicator
        function updateScanningIndicator() {
            const indicator = document.getElementById('scanningIndicator');
            if (indicator) {
                indicator.style.display = 'block';
            }
        }

        // Continuous scanning function - optimized for speed
        function scanContinuously() {
            if (!scanning) return;
            
            if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
                // Use smaller canvas for faster processing
                const scale = 0.5; // Process at 50% resolution for speed
                const width = video.videoWidth * scale;
                const height = video.videoHeight * scale;
                
                canvas.width = width;
                canvas.height = height;
                
                // Draw video frame to canvas
                canvasContext.drawImage(video, 0, 0, width, height);
                
                try {
                    const imageData = canvasContext.getImageData(0, 0, width, height);
                    
                    // Try to detect QR code with multiple settings
                    let code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: "attemptBoth"
                    });
                    
                    if (!code) {
                        // Try with different inversion
                        code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: "invertFirst"
                        });
                    }
                    
                    if (code && code.data) {
                        console.log("QR Code found:", code.data);
                        
                        // Visual feedback
                        document.getElementById('scanningOverlay').style.display = 'none';
                        
                        // Process the QR code
                        handleQRCodeData(code.data);
                        
                        // Stop scanning after successful detection
                        scanning = false;
                        return;
                    }
                } catch (error) {
                    console.error('Scanning error:', error);
                }
            }
            
            // Continue scanning at high frequency
            setTimeout(() => {
                if (scanning) {
                    scanContinuously();
                }
            }, 50); // Scan 20 times per second for fast detection
        }

        // Handle detected QR code data
        function handleQRCodeData(qrData) {
            try {
                const data = JSON.parse(qrData);
                
                // Show result in scanner
                document.getElementById('scannerResult').style.display = 'block';
                document.getElementById('scannerResultText').textContent = `Item: ${data.item || 'Unknown'}`;
                
                // Display specification
                displaySpecification(data);
                addToHistory(data);
                showNotification('QR Code scanned successfully!');
                
                // Stop scanning after successful read
                setTimeout(() => {
                    stopCamera();
                }, 2000);
                
            } catch (error) {
                console.error('Error parsing QR data:', error);
                // Try to handle non-JSON QR codes
                showNotification('QR code detected but format not recognized', 'error');
            }
        }

        // Process manual data input
        function processManualData() {
            const manualData = document.getElementById('manualData').value;
            
            if (!manualData.trim()) {
                showNotification('Please paste QR code data', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(manualData);
                displaySpecification(data);
                addToHistory(data);
                showNotification('Data processed successfully!');
                document.getElementById('manualData').value = '';
            } catch (error) {
                showNotification('Invalid JSON format. Please check your data.', 'error');
            }
        }

        // Handle file upload for QR code image
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                showNotification('File uploaded. For demo purposes, using sample data.');
                // In a real implementation, this would use a QR code reader library
                // For now, we'll load sample data to demonstrate functionality
                setTimeout(() => {
                    loadSampleData();
                    processManualData();
                }, 1000);
            }
        }

        // Display specification details
        function displaySpecification(data) {
            const resultContainer = document.getElementById('resultContainer');
            
            // Determine item category
            let category = 'General';
            if (data.type) {
                const categories = {
                    'shirt': 'Formal Wear',
                    'trouser': 'Formal Wear',
                    'pinafore': 'Girls Uniform',
                    'house': 'Sports Wear',
                    'blazer': 'Winter Wear'
                };
                category = categories[data.type] || 'General';
            }
            
            // Format timestamp
            const timestamp = new Date(data.timestamp || new Date());
            const formattedDate = timestamp.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedTime = timestamp.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Extended data for complete specifications
            const extendedData = getExtendedSpecifications(data.type);
            
            resultContainer.innerHTML = `
                <div class="spec-card">
                    <div class="spec-header">
                        <div class="spec-title">
                            <h3>${data.item || 'Unknown Item'}</h3>
                            <p>${data.client || 'No client specified'}</p>
                        </div>
                        <span class="spec-badge">${category}</span>
                    </div>
                    
                    <div class="spec-grid">
                        <div class="spec-item">
                            <label>Project Code</label>
                            <div class="value">${data.project || 'N/A'}</div>
                        </div>
                        
                        <div class="spec-item">
                            <label>Project Date</label>
                            <div class="value">${data.date || 'N/A'}</div>
                        </div>
                        
                        <div class="spec-item">
                            <label>Fabric Composition</label>
                            <div class="value">${data.fabric || 'Not specified'}</div>
                        </div>
                        
                        <div class="spec-item">
                            <label>Color Specification</label>
                            <div class="value">${data.color || 'Not specified'}</div>
                        </div>
                        
                        ${extendedData ? `
                        <div class="spec-item">
                            <label>GSM Weight</label>
                            <div class="value">${extendedData.gsm}</div>
                        </div>
                        
                        <div class="spec-item">
                            <label>Size Range</label>
                            <div class="value">${extendedData.sizes}</div>
                        </div>
                        
                        <div class="spec-item" style="grid-column: 1/-1;">
                            <label>Special Features</label>
                            <div class="value">${extendedData.features}</div>
                        </div>
                        
                        <div class="spec-item" style="grid-column: 1/-1;">
                            <label>Care Instructions</label>
                            <div class="value">${extendedData.care}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="timestamp-info">
                        <div class="time">
                            <strong>Scanned on:</strong> ${formattedDate} at ${formattedTime}
                        </div>
                        <div>
                            <span class="spec-badge" style="background: #10b981;">
                                ${data.type ? data.type.toUpperCase() : 'ITEM'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="exportSpecification('${btoa(JSON.stringify(data))}')">
                            💾 Export Details
                        </button>
                        <button class="btn btn-secondary" onclick="printSpecification()">
                            🖨️ Print
                        </button>
                        <button class="btn btn-success" onclick="generateReport('${btoa(JSON.stringify(data))}')">
                            📄 Generate Report
                        </button>
                        <button class="btn btn-secondary" onclick="shareSpecification('${btoa(JSON.stringify(data))}')">
                            📤 Share
                        </button>
                    </div>
                </div>
            `;
        }

        // Get extended specifications based on item type
        function getExtendedSpecifications(type) {
            const specs = {
                shirt: {
                    gsm: "180 GSM",
                    sizes: "20-42 (Even sizes)",
                    features: "Double stitched collar, reinforced button holes, chest pocket with monogram",
                    care: "Machine washable at 40°C, tumble dry low, iron medium heat"
                },
                trouser: {
                    gsm: "220 GSM",
                    sizes: "20-42 (Even sizes)",
                    features: "Belt loops, YKK zipper, reinforced knee area, two side pockets",
                    care: "Machine washable, wrinkle-resistant, do not bleach"
                },
                pinafore: {
                    gsm: "200 GSM",
                    sizes: "20-30 (Junior sizes)",
                    features: "Adjustable straps, box pleats, side zipper, front bib pocket",
                    care: "Gentle wash, hang dry, low iron if needed"
                },
                house: {
                    gsm: "150 GSM",
                    sizes: "XS, S, M, L, XL, XXL",
                    features: "Moisture-wicking, UV protection SPF 30+, anti-bacterial, raglan sleeves",
                    care: "Quick dry, machine washable, do not iron"
                },
                blazer: {
                    gsm: "280 GSM",
                    sizes: "32-44 (Chest measurement)",
                    features: "Fully lined, inside pockets, metal buttons with crest, back vent",
                    care: "Dry clean only, store on hanger, steam to remove wrinkles"
                }
            };
            
            return specs[type] || null;
        }

        // Add scan to history
        function addToHistory(data) {
            scanHistory.unshift({
                ...data,
                scannedAt: new Date().toISOString(),
                id: Date.now()
            });
            
            if (scanHistory.length > 10) {
                scanHistory = scanHistory.slice(0, 10);
            }
            
            localStorage.setItem('scanHistory', JSON.stringify(scanHistory));
            updateHistoryDisplay();
        }

        // Update history display
        function updateHistoryDisplay() {
            const historyContainer = document.getElementById('historyContainer');
            
            if (scanHistory.length === 0) {
                historyContainer.innerHTML = '<p style="color: #999; text-align: center; grid-column: 1/-1;">No scan history available</p>';
                return;
            }
            
            historyContainer.innerHTML = scanHistory.map(item => {
                const scannedAt = new Date(item.scannedAt);
                return `
                    <div class="history-item" onclick='viewHistoryItem(${JSON.stringify(item)})'>
                        <h4>${item.item || 'Unknown Item'}</h4>
                        <p><strong>Client:</strong> ${item.client || 'N/A'}</p>
                        <p><strong>Project:</strong> ${item.project || 'N/A'}</p>
                        <p style="color: #999; font-size: 0.85rem; margin-top: 10px;">
                            ${scannedAt.toLocaleDateString()} ${scannedAt.toLocaleTimeString()}
                        </p>
                    </div>
                `;
            }).join('');
        }

        // View history item
        function viewHistoryItem(item) {
            displaySpecification(item);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Load sample data
        function loadSampleData() {
            const sampleData = {
                "type": "shirt",
                "item": "Boys Half-sleeve Formal Shirt",
                "client": "St. Mary's International School",
                "project": "SMIS-2024-UNI-001",
                "date": "2024-01-15",
                "fabric": "60% Cotton, 40% Polyester Blend",
                "color": "Pantone 5415C (Light Blue)",
                "timestamp": new Date().toISOString()
            };
            
            document.getElementById('manualData').value = JSON.stringify(sampleData, null, 2);
            showNotification('Sample data loaded. Click "Process Data" to view.');
        }

        // Export specification
        function exportSpecification(encodedData) {
            const data = JSON.parse(atob(encodedData));
            const extendedData = getExtendedSpecifications(data.type);
            const fullData = { ...data, ...extendedData };
            
            const dataStr = JSON.stringify(fullData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `specification-${data.project || 'export'}-${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Specification exported successfully!');
        }

        // Generate report
        function generateReport(encodedData) {
            const data = JSON.parse(atob(encodedData));
            const extendedData = getExtendedSpecifications(data.type);
            
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Specification Report - ${data.item}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; }
                        h1 { color: #333; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
                        .section { margin: 20px 0; }
                        .section h2 { color: #667eea; }
                        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
                        .item { padding: 10px; background: #f8f9ff; border-radius: 5px; }
                        .label { font-weight: bold; color: #666; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #999; }
                    </style>
                </head>
                <body>
                    <h1>Uniform Specification Report</h1>
                    <div class="section">
                        <h2>${data.item}</h2>
                        <div class="grid">
                            <div class="item"><span class="label">Client:</span> ${data.client}</div>
                            <div class="item"><span class="label">Project Code:</span> ${data.project}</div>
                            <div class="item"><span class="label">Date:</span> ${data.date}</div>
                            <div class="item"><span class="label">Type:</span> ${data.type}</div>
                            <div class="item"><span class="label">Fabric:</span> ${data.fabric}</div>
                            <div class="item"><span class="label">Color:</span> ${data.color}</div>
                            ${extendedData ? `
                            <div class="item"><span class="label">GSM:</span> ${extendedData.gsm}</div>
                            <div class="item"><span class="label">Sizes:</span> ${extendedData.sizes}</div>
                            <div class="item" style="grid-column: 1/-1;"><span class="label">Features:</span> ${extendedData.features}</div>
                            <div class="item" style="grid-column: 1/-1;"><span class="label">Care:</span> ${extendedData.care}</div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="footer">
                        Generated on ${new Date().toLocaleString()}
                    </div>
                </body>
                </html>
            `);
            
            showNotification('Report generated in new window');
        }

        // Print specification
        function printSpecification() {
            window.print();
            showNotification('Print dialog opened');
        }

        // Share specification
        function shareSpecification(encodedData) {
            const data = JSON.parse(atob(encodedData));
            const shareText = `Uniform Specification:
${data.item}
Client: ${data.client}
Project: ${data.project}
Fabric: ${data.fabric}
Color: ${data.color}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Uniform Specification',
                    text: shareText
                }).catch(err => console.log('Share cancelled'));
            } else {
                navigator.clipboard.writeText(shareText);
                showNotification('Specification copied to clipboard!');
            }
        }

        // Clear history
        function clearHistory() {
            if (confirm('Are you sure you want to clear all scan history?')) {
                scanHistory = [];
                localStorage.removeItem('scanHistory');
                updateHistoryDisplay();
                showNotification('History cleared');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = type === 'error' ? 'notification error' : 'notification';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Load history on page load
        function loadHistory() {
            const saved = localStorage.getItem('scanHistory');
            if (saved) {
                try {
                    scanHistory = JSON.parse(saved);
                    updateHistoryDisplay();
                } catch (error) {
                    console.error('Error loading history:', error);
                }
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            
            // Auto-load sample data for easy testing
            setTimeout(() => {
                showNotification('Click "Load Sample Data" to test the scanner');
            }, 1000);
        });
    </script>
</body>
</html>
